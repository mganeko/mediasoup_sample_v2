/*
 * mediasoup-client v2.1.4
 * mediasoup client side JavaScript SDK
 * https://mediasoup.org
 * Copyright © 2017, Iñaki Baz Castillo <ibc@aliax.net>
 * License: ISC
 */

!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).mediasoupClient=e()}}(function(){return function(){return function e(t,r,n){function o(i,s){if(!r[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(a)return a(i,!0);var u=new Error("Cannot find module '"+i+"'");throw u.code="MODULE_NOT_FOUND",u}var d=r[i]={exports:{}};t[i][0].call(d.exports,function(e){return o(t[i][1][e]||e)},d,d.exports,e,t,r,n)}return r[i].exports}for(var a="function"==typeof require&&require,i=0;i<n.length;i++)o(n[i]);return o}}()({1:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n,o=e("events"),a=(n=e("./Logger"))&&n.__esModule?n:{default:n},i=e("./errors");function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=new a.default("CommandQueue"),f=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=u(this,d(t).call(this))).setMaxListeners(1/0),e._closed=!1,e._busy=!1,e._queue=[],e}var r,n,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,o.EventEmitter),r=t,(n=[{key:"close",value:function(){this._closed=!0}},{key:"push",value:function(e,t){var r=this,n=Object.assign({method:e},t);return p.debug("push() [method:%s]",e),new Promise(function(e,t){var o=r._queue;n.resolve=e,n.reject=t,o.push(n),r._handlePendingCommands()})}},{key:"_handlePendingCommands",value:function(){var e=this;if(!this._busy){var t=this._queue,r=t[0];r&&(this._busy=!0,this._handleCommand(r).then(function(){e._busy=!1,t.shift(),e._handlePendingCommands()}))}}},{key:"_handleCommand",value:function(e){var t=this;if(p.debug("_handleCommand() [method:%s]",e.method),this._closed)return e.reject(new i.InvalidStateError("closed")),Promise.resolve();var r={promise:null};return this.emit("exec",e,r),Promise.resolve().then(function(){return r.promise}).then(function(r){p.debug("_handleCommand() | command succeeded [method:%s]",e.method),t._closed?e.reject(new i.InvalidStateError("closed")):e.resolve(r)}).catch(function(t){p.error("_handleCommand() | command failed [method:%s]: %o",e.method,t),e.reject(t)})}}])&&c(r.prototype,n),a&&c(r,a),t}();r.default=f},{"./Logger":5,"./errors":10,events:29}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=i(e("./Logger")),o=i(e("./EnhancedEventEmitter")),a=e("./errors");function i(e){return e&&e.__esModule?e:{default:e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=new Set(["default","low","medium","high"]),f=1e3,m=new n.default("Consumer"),h=function(e){function t(e,r,n,o,a){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=u(this,d(t).call(this,m)))._id=e,i._closed=!1,i._kind=r,i._rtpParameters=n,i._peer=o,i._appData=a,i._supported=!1,i._transport=null,i._track=null,i._locallyPaused=!1,i._remotelyPaused=!1,i._statsEnabled=!1,i._statsInterval=f,i._preferredProfile="default",i._effectiveProfile=null,i}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,o.default),r=t,(n=[{key:"close",value:function(){m.debug("close()"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.transport&&this.transport.disableConsumerStats(this)),this.emit("@close"),this.safeEmit("close","local"),this._destroy())}},{key:"remoteClose",value:function(){m.debug("remoteClose()"),this._closed||(this._closed=!0,this._transport&&this._transport.removeConsumer(this),this._destroy(),this.emit("@close"),this.safeEmit("close","remote"))}},{key:"_destroy",value:function(){this._transport=null;try{this._track.stop()}catch(e){}this._track=null}},{key:"receive",value:function(e){var t=this;return m.debug("receive() [transport:%o]",e),this._closed?Promise.reject(new a.InvalidStateError("Consumer closed")):this._supported?this._transport?Promise.reject(new Error("already handled by a Transport")):"object"!==s(e)?Promise.reject(new TypeError("invalid Transport")):(this._transport=e,e.addConsumer(this).then(function(r){return t._track=r,t.paused&&(r.enabled=!1),e.once("@close",function(){if(!t._closed&&t._transport===e){t._transport=null;try{t._track.stop()}catch(e){}t._track=null,t.safeEmit("unhandled")}}),t.safeEmit("handled"),t._statsEnabled&&e.enableConsumerStats(t,t._statsInterval),r}).catch(function(e){throw t._transport=null,e})):Promise.reject(new Error("unsupported codecs"))}},{key:"pause",value:function(e){return m.debug("pause()"),this._closed?(m.error("pause() | Consumer closed"),!1):!!this._locallyPaused||(this._locallyPaused=!0,this._track&&(this._track.enabled=!1),this._transport&&this._transport.pauseConsumer(this,e),this.safeEmit("pause","local",e),this.paused)}},{key:"remotePause",value:function(e){m.debug("remotePause()"),this._closed||this._remotelyPaused||(this._remotelyPaused=!0,this._track&&(this._track.enabled=!1),this.safeEmit("pause","remote",e))}},{key:"resume",value:function(e){return m.debug("resume()"),this._closed?(m.error("resume() | Consumer closed"),!1):!this._locallyPaused||(this._locallyPaused=!1,this._track&&!this._remotelyPaused&&(this._track.enabled=!0),this._transport&&this._transport.resumeConsumer(this,e),this.safeEmit("resume","local",e),!this.paused)}},{key:"remoteResume",value:function(e){m.debug("remoteResume()"),!this._closed&&this._remotelyPaused&&(this._remotelyPaused=!1,this._track&&!this._locallyPaused&&(this._track.enabled=!0),this.safeEmit("resume","remote",e))}},{key:"setPreferredProfile",value:function(e){m.debug("setPreferredProfile() [profile:%s]",e),this._closed?m.error("setPreferredProfile() | Consumer closed"):e!==this._preferredProfile&&(p.has(e)?(this._preferredProfile=e,this._transport&&this._transport.setConsumerPreferredProfile(this,this._preferredProfile)):m.error('setPreferredProfile() | invalid profile "%s"',e))}},{key:"remoteSetPreferredProfile",value:function(e){m.debug("remoteSetPreferredProfile() [profile:%s]",e),this._closed||e===this._preferredProfile||(this._preferredProfile=e)}},{key:"remoteEffectiveProfileChanged",value:function(e){m.debug("remoteEffectiveProfileChanged() [profile:%s]",e),this._closed||e===this._effectiveProfile||(this._effectiveProfile=e,this.safeEmit("effectiveprofilechange",this._effectiveProfile))}},{key:"enableStats",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;m.debug("enableStats() [interval:%s]",e),this._closed?m.error("enableStats() | Consumer closed"):this._statsEnabled||(this._statsInterval="number"!=typeof e||e<1e3?f:e,this._statsEnabled=!0,this._transport&&this._transport.enableConsumerStats(this,this._statsInterval))}},{key:"disableStats",value:function(){m.debug("disableStats()"),this._closed?m.error("disableStats() | Consumer closed"):this._statsEnabled&&(this._statsEnabled=!1,this._transport&&this._transport.disableConsumerStats(this))}},{key:"setSupported",value:function(e){this._supported=e}},{key:"remoteStats",value:function(e){this.safeEmit("stats",e)}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"kind",get:function(){return this._kind}},{key:"rtpParameters",get:function(){return this._rtpParameters}},{key:"peer",get:function(){return this._peer}},{key:"appData",get:function(){return this._appData}},{key:"supported",get:function(){return this._supported}},{key:"transport",get:function(){return this._transport}},{key:"track",get:function(){return this._track}},{key:"locallyPaused",get:function(){return this._locallyPaused}},{key:"remotelyPaused",get:function(){return this._remotelyPaused}},{key:"paused",get:function(){return this._locallyPaused||this._remotelyPaused}},{key:"preferredProfile",get:function(){return this._preferredProfile}},{key:"effectiveProfile",get:function(){return this._effectiveProfile}}])&&c(r.prototype,n),i&&c(r,i),t}();r.default=h},{"./EnhancedEventEmitter":4,"./Logger":5,"./errors":10}],3:[function(e,t,r){(function(t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=f(e("bowser")),o=f(e("./Logger")),a=f(e("./handlers/Chrome69")),i=f(e("./handlers/Chrome67")),s=f(e("./handlers/Chrome55")),c=f(e("./handlers/Safari11")),u=f(e("./handlers/Firefox50")),d=f(e("./handlers/Firefox59")),l=f(e("./handlers/Edge11")),p=f(e("./handlers/ReactNative"));function f(e){return e&&e.__esModule?e:{default:e}}function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var h=new o.default("Device"),v=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var r,o,f;return r=e,f=[{key:"getFlag",value:function(){return e._detected||e._detect(),e._flag}},{key:"getName",value:function(){return e._detected||e._detect(),e._name}},{key:"getVersion",value:function(){return e._detected||e._detect(),e._version}},{key:"getBowser",value:function(){return e._detected||e._detect(),e._bowser}},{key:"isSupported",value:function(){return e._detected||e._detect(),Boolean(e._handlerClass)}},{key:"_detect",value:function(){if(e._detected=!0,t.navigator&&"ReactNative"===t.navigator.product)e._flag="react-native",e._name="ReactNative",e._version=void 0,e._bowser={},e._handlerClass=p.default;else if(t.navigator&&"string"==typeof t.navigator.userAgent){var r=t.navigator.userAgent,o=n.default.detect(r);e._flag=void 0,e._name=o.name||void 0,e._version=o.version||void 0,e._bowser=o,e._handlerClass=null,n.default.check({chrome:"69",chromium:"69"},!0,r)?(e._flag="chrome",e._handlerClass=a.default):n.default.check({chrome:"67",chromium:"67"},!0,r)?(e._flag="chrome",e._handlerClass=i.default):n.default.check({chrome:"55",chromium:"55"},!0,r)?(e._flag="chrome",e._handlerClass=s.default):n.default.check({firefox:"59"},!0,r)?(e._flag="firefox",e._handlerClass=d.default):n.default.check({firefox:"50"},!0,r)?(e._flag="firefox",e._handlerClass=u.default):n.default.check({safari:"11"},!0,r)?(e._flag="safari",e._handlerClass=c.default):n.default.check({msedge:"11"},!0,r)&&(e._flag="msedge",e._handlerClass=l.default),n.default.check({opera:"44"},!0,r)&&(e._flag="opera",e._handlerClass=s.default),e.isSupported()?h.debug('browser supported [flag:%s, name:"%s", version:%s, handler:%s]',e._flag,e._name,e._version,e._handlerClass.tag):h.warn("browser not supported [name:%s, version:%s]",e._name,e._version)}else h.warn("device not supported")}},{key:"Handler",get:function(){return e._detected||e._detect(),e._handlerClass}}],(o=null)&&m(r.prototype,o),f&&m(r,f),e}();r.default=v,v._detected=!1,v._flag=void 0,v._name=void 0,v._version=void 0,v._bowser=void 0,v._handlerClass=null}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Logger":5,"./handlers/Chrome55":11,"./handlers/Chrome67":12,"./handlers/Chrome69":13,"./handlers/Edge11":14,"./handlers/Firefox50":15,"./handlers/Firefox59":16,"./handlers/ReactNative":17,"./handlers/Safari11":18,bowser:28}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n,o=e("events"),a=(n=e("./Logger"))&&n.__esModule?n:{default:n};function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=c(this,u(t).call(this))).setMaxListeners(1/0),r._logger=e||new a.default("EnhancedEventEmitter"),r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,o.EventEmitter),r=t,(n=[{key:"safeEmit",value:function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.emit.apply(this,[e].concat(r))}catch(t){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",e,t)}}},{key:"safeEmitAsPromise",value:function(e){for(var t=this,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return new Promise(function(r,o){t.safeEmit.apply(t,[e].concat(n,[function(e){r(e)},function(r){t._logger.error("safeEmitAsPromise() | errback called [event:%s]:%o",e,r),o(r)}]))})}}])&&s(r.prototype,n),i&&s(r,i),t}();r.default=l},{"./Logger":5,events:29}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n,o=(n=e("debug"))&&n.__esModule?n:{default:n};function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i="mediasoup-client",s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t?(this._debug=(0,o.default)("".concat(i,":").concat(t)),this._warn=(0,o.default)("".concat(i,":WARN:").concat(t)),this._error=(0,o.default)("".concat(i,":ERROR:").concat(t))):(this._debug=(0,o.default)(i),this._warn=(0,o.default)("".concat(i,":WARN")),this._error=(0,o.default)("".concat(i,":ERROR"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}var t,r,n;return t=e,(r=[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}])&&a(t.prototype,r),n&&a(t,n),e}();r.default=s},{debug:31}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=a(e("./Logger")),o=a(e("./EnhancedEventEmitter"));function a(e){return e&&e.__esModule?e:{default:e}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=new n.default("Peer"),p=function(e){function t(e,r){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=c(this,u(t).call(this,l)))._name=e,n._closed=!1,n._appData=r,n._consumers=new Map,n}var r,n,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,o.default),r=t,(n=[{key:"close",value:function(){if(l.debug("close()"),!this._closed){this._closed=!0,this.emit("@close"),this.safeEmit("close","local");var e=!0,t=!1,r=void 0;try{for(var n,o=this._consumers.values()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.close()}}catch(e){t=!0,r=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw r}}}}},{key:"remoteClose",value:function(e){if(l.debug("remoteClose()"),!this._closed){this._closed=!0,this.emit("@close"),this.safeEmit("close","remote",e);var t=!0,r=!1,n=void 0;try{for(var o,a=this._consumers.values()[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){o.value.remoteClose()}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}}},{key:"getConsumerById",value:function(e){return this._consumers.get(e)}},{key:"addConsumer",value:function(e){var t=this;if(this._consumers.has(e.id))throw new Error("Consumer already exists [id:".concat(e.id,"]"));this._consumers.set(e.id,e),e.on("@close",function(){t._consumers.delete(e.id)}),this.safeEmit("newconsumer",e)}},{key:"name",get:function(){return this._name}},{key:"closed",get:function(){return this._closed}},{key:"appData",get:function(){return this._appData}},{key:"consumers",get:function(){return Array.from(this._consumers.values())}}])&&s(r.prototype,n),a&&s(r,a),t}();r.default=p},{"./EnhancedEventEmitter":4,"./Logger":5}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=s(e("./Logger")),o=s(e("./EnhancedEventEmitter")),a=e("./errors"),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(e("./utils"));function s(e){return e&&e.__esModule?e:{default:e}}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=1e3,m={low:1e5,medium:3e5,high:15e5},h=new n.default("Producer"),v=function(e){function t(e,r,n){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=d(this,l(t).call(this,h)))._id=i.randomNumber(),o._closed=!1,o._originalTrack=e;try{o._track=e.clone()}catch(t){o._track=e}return o._appData=n,o._simulcast=!1,"object"===c(r.simulcast)?o._simulcast=Object.assign({},m,r.simulcast):!0===r.simulcast&&(o._simulcast=Object.assign({},m)),o._transport=null,o._rtpParameters=null,o._locallyPaused=!o._track.enabled,o._remotelyPaused=!1,o._statsEnabled=!1,o._statsInterval=f,o._handleTrack(),o}var r,n,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,o.default),r=t,(n=[{key:"close",value:function(e){h.debug("close()"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.transport&&this.transport.disableProducerStats(this)),this._transport&&this._transport.removeProducer(this,"local",e),this._destroy(),this.emit("@close","local",e),this.safeEmit("close","local",e))}},{key:"remoteClose",value:function(e){h.debug("remoteClose()"),this._closed||(this._closed=!0,this._transport&&this._transport.removeProducer(this,"remote",e),this._destroy(),this.emit("@close","remote",e),this.safeEmit("close","remote",e))}},{key:"_destroy",value:function(){this._transport=!1,this._rtpParameters=null;try{this._track.stop()}catch(e){}}},{key:"send",value:function(e){var t=this;return h.debug("send() [transport:%o]",e),this._closed?Promise.reject(new a.InvalidStateError("Producer closed")):this._transport?Promise.reject(new Error("already handled by a Transport")):"object"!==c(e)?Promise.reject(new TypeError("invalid Transport")):(this._transport=e,e.addProducer(this).then(function(){e.once("@close",function(){t._closed||t._transport!==e||(t._transport.removeProducer(t,"local"),t._transport=null,t._rtpParameters=null,t.safeEmit("unhandled"))}),t.safeEmit("handled"),t._statsEnabled&&e.enableProducerStats(t,t._statsInterval)}).catch(function(e){throw t._transport=null,e}))}},{key:"pause",value:function(e){return h.debug("pause()"),this._closed?(h.error("pause() | Producer closed"),!1):!!this._locallyPaused||(this._locallyPaused=!0,this._track.enabled=!1,this._transport&&this._transport.pauseProducer(this,e),this.safeEmit("pause","local",e),this.paused)}},{key:"remotePause",value:function(e){h.debug("remotePause()"),this._closed||this._remotelyPaused||(this._remotelyPaused=!0,this._track.enabled=!1,this.safeEmit("pause","remote",e))}},{key:"resume",value:function(e){return h.debug("resume()"),this._closed?(h.error("resume() | Producer closed"),!1):!this._locallyPaused||(this._locallyPaused=!1,this._remotelyPaused||(this._track.enabled=!0),this._transport&&this._transport.resumeProducer(this,e),this.safeEmit("resume","local",e),!this.paused)}},{key:"remoteResume",value:function(e){h.debug("remoteResume()"),!this._closed&&this._remotelyPaused&&(this._remotelyPaused=!1,this._locallyPaused||(this._track.enabled=!0),this.safeEmit("resume","remote",e))}},{key:"replaceTrack",value:function(e){var t,r=this;if(h.debug("replaceTrack() [track:%o]",e),this._closed)return Promise.reject(new a.InvalidStateError("Producer closed"));if(!(e instanceof MediaStreamTrack))return Promise.reject(new TypeError("track is not a MediaStreamTrack"));if("ended"===e.readyState)return Promise.reject(new Error('track.readyState is "ended"'));try{t=e.clone()}catch(r){t=e}return Promise.resolve().then(function(){if(r._transport)return r._transport.replaceProducerTrack(r,t)}).then(function(){try{r._track.onended=null,r._track.stop()}catch(e){}return r.paused?t.enabled=!1:t.enabled=!0,r._originalTrack=e,r._track=t,r._handleTrack(),r._track})}},{key:"setRtpParameters",value:function(e){this._rtpParameters=e}},{key:"enableStats",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;h.debug("enableStats() [interval:%s]",e),this._closed?h.error("enableStats() | Producer closed"):this._statsEnabled||(this._statsInterval="number"!=typeof e||e<1e3?f:e,this._statsEnabled=!0,this._transport&&this._transport.enableProducerStats(this,this._statsInterval))}},{key:"disableStats",value:function(){h.debug("disableStats()"),this._closed?h.error("disableStats() | Producer closed"):this._statsEnabled&&(this._statsEnabled=!1,this._transport&&this._transport.disableProducerStats(this))}},{key:"remoteStats",value:function(e){this.safeEmit("stats",e)}},{key:"_handleTrack",value:function(){var e=this;this._track.onended=function(){e._closed||(h.warn('track "ended" event'),e.safeEmit("trackended"))}}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"kind",get:function(){return this._track.kind}},{key:"track",get:function(){return this._track}},{key:"originalTrack",get:function(){return this._originalTrack}},{key:"simulcast",get:function(){return this._simulcast}},{key:"appData",get:function(){return this._appData}},{key:"transport",get:function(){return this._transport}},{key:"rtpParameters",get:function(){return this._rtpParameters}},{key:"locallyPaused",get:function(){return this._locallyPaused}},{key:"remotelyPaused",get:function(){return this._remotelyPaused}},{key:"paused",get:function(){return this._locallyPaused||this._remotelyPaused}}])&&u(r.prototype,n),s&&u(r,s),t}();r.default=v},{"./EnhancedEventEmitter":4,"./Logger":5,"./errors":10,"./utils":27}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=p(e("./Logger")),o=p(e("./EnhancedEventEmitter")),a=e("./errors"),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(e("./ortc")),s=p(e("./Device")),c=p(e("./Transport")),u=p(e("./Producer")),d=p(e("./Peer")),l=p(e("./Consumer"));function p(e){return e&&e.__esModule?e:{default:e}}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _=new n.default("Room"),g={new:"new",joining:"joining",joined:"joined",closed:"closed"},b=function(e){function t(e){var r;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=h(this,v(t).call(this,_)),_.debug("constructor() [options:%o]",e),!s.default.isSupported())throw new Error("current browser/device not supported");return e=e||{},r._settings={roomSettings:e.roomSettings,requestTimeout:e.requestTimeout||1e4,transportOptions:e.transportOptions||{},turnServers:e.turnServers||[],iceTransportPolicy:e.iceTransportPolicy||"all"},r._state=g.new,r._peerName=null,r._transports=new Map,r._producers=new Map,r._peers=new Map,r._extendedRtpCapabilities=null,r._canSendByKind={audio:!1,video:!1},r}var r,n,p;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(t,o.default),r=t,(n=[{key:"getTransportById",value:function(e){return this._transports.get(e)}},{key:"getProducerById",value:function(e){return this._producers.get(e)}},{key:"getPeerByName",value:function(e){return this._peers.get(e)}},{key:"join",value:function(e,t){var r,n=this;return _.debug('join() [peerName:"%s"]',e),"string"!=typeof e?Promise.reject(new TypeError("invalid peerName")):this._state!==g.new&&this._state!==g.closed?Promise.reject(new a.InvalidStateError('invalid state "'.concat(this._state,'"'))):(this._peerName=e,this._state=g.joining,Promise.resolve().then(function(){return n._settings.roomSettings?void(r=n._settings.roomSettings):n._sendRequest("queryRoom",{target:"room"}).then(function(e){r=e,_.debug("join() | got Room settings:%o",r)})}).then(function(){return s.default.Handler.getNativeRtpCapabilities()}).then(function(e){_.debug("join() | native RTP capabilities:%o",e),n._extendedRtpCapabilities=i.getExtendedRtpCapabilities(e,r.rtpCapabilities),_.debug("join() | extended RTP capabilities:%o",n._extendedRtpCapabilities);var o=i.getUnsupportedCodecs(r.rtpCapabilities,r.mandatoryCodecPayloadTypes,n._extendedRtpCapabilities);if(o.length>0)throw _.error("%s mandatory room codecs not supported:%o",o.length,o),new a.UnsupportedError("mandatory room codecs not supported",o);n._canSendByKind.audio=i.canSend("audio",n._extendedRtpCapabilities),n._canSendByKind.video=i.canSend("video",n._extendedRtpCapabilities);var s=i.getRtpCapabilities(n._extendedRtpCapabilities);_.debug("join() | effective local RTP capabilities for receiving:%o",s);var c={target:"room",peerName:n._peerName,rtpCapabilities:s,appData:t};return n._sendRequest("join",c).then(function(e){return e.peers})}).then(function(e){var t=!0,r=!1,o=void 0;try{for(var a,i=(e||[])[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var s=a.value;try{n._handlePeerData(s)}catch(e){_.error("join() | error handling Peer:%o",e)}}}catch(e){r=!0,o=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw o}}return n._state=g.joined,_.debug("join() | joined the Room"),n.peers}).catch(function(e){throw n._state=g.new,e}))}},{key:"leave",value:function(e){if(_.debug("leave()"),!this.closed){this._sendNotification("leave",{appData:e}),this._state=g.closed,this.safeEmit("close","local",e);var t=!0,r=!1,n=void 0;try{for(var o,a=this._transports.values()[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){o.value.close()}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}var i=!0,s=!1,c=void 0;try{for(var u,d=this._producers.values()[Symbol.iterator]();!(i=(u=d.next()).done);i=!0){u.value.close()}}catch(e){s=!0,c=e}finally{try{i||null==d.return||d.return()}finally{if(s)throw c}}var l=!0,p=!1,f=void 0;try{for(var m,h=this._peers.values()[Symbol.iterator]();!(l=(m=h.next()).done);l=!0){m.value.close()}}catch(e){p=!0,f=e}finally{try{l||null==h.return||h.return()}finally{if(p)throw f}}}}},{key:"remoteClose",value:function(e){if(_.debug("remoteClose()"),!this.closed){this._state=g.closed,this.safeEmit("close","remote",e);var t=!0,r=!1,n=void 0;try{for(var o,a=this._transports.values()[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){o.value.remoteClose()}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}var i=!0,s=!1,c=void 0;try{for(var u,d=this._producers.values()[Symbol.iterator]();!(i=(u=d.next()).done);i=!0){u.value.remoteClose()}}catch(e){s=!0,c=e}finally{try{i||null==d.return||d.return()}finally{if(s)throw c}}var l=!0,p=!1,f=void 0;try{for(var m,h=this._peers.values()[Symbol.iterator]();!(l=(m=h.next()).done);l=!0){m.value.remoteClose()}}catch(e){p=!0,f=e}finally{try{l||null==h.return||h.return()}finally{if(p)throw f}}}}},{key:"canSend",value:function(e){if(!this.joined)throw new a.InvalidStateError('invalid state "'.concat(this._state,'"'));if("audio"!==e&&"video"!==e)throw new TypeError('invalid kind "'.concat(e,'"'));return this._canSendByKind[e]}},{key:"createTransport",value:function(e,t){var r=this;if(_.debug("createTransport() [direction:%s]",e),!this.joined)throw new a.InvalidStateError('invalid state "'.concat(this._state,'"'));if("send"!==e&&"recv"!==e)throw new TypeError('invalid direction "'.concat(e,'"'));var n=new c.default(e,this._extendedRtpCapabilities,this._settings,t);return this._transports.set(n.id,n),n.on("@request",function(e,t,n,o){r._sendRequest(e,t).then(n).catch(o)}),n.on("@notify",function(e,t){r._sendNotification(e,t)}),n.on("@close",function(){r._transports.delete(n.id)}),n}},{key:"createProducer",value:function(e,t,r){var n=this;if(_.debug("createProducer() [track:%o, options:%o]",e,t),!this.joined)throw new a.InvalidStateError('invalid state "'.concat(this._state,'"'));if(!(e instanceof MediaStreamTrack))throw new TypeError("track is not a MediaStreamTrack");if(!this._canSendByKind[e.kind])throw new Error("cannot send ".concat(e.kind));if("ended"===e.readyState)throw new Error('track.readyState is "ended"');t=t||{};var o=new u.default(e,t,r);return this._producers.set(o.id,o),o.on("@close",function(){n._producers.delete(o.id)}),o}},{key:"restartIce",value:function(){if(!this.joined)throw new a.InvalidStateError('invalid state "'.concat(this._state,'"'));var e=!0,t=!1,r=void 0;try{for(var n,o=this._transports.values()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.restartIce()}}catch(e){t=!0,r=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw r}}}},{key:"receiveNotification",value:function(e){var t=this;if(this.closed)return Promise.reject(new a.InvalidStateError("Room closed"));if("object"!==f(e))return Promise.reject(new TypeError("wrong notification Object"));if(!0!==e.notification)return Promise.reject(new TypeError("not a notification"));if("string"!=typeof e.method)return Promise.reject(new TypeError("wrong/missing notification method"));var r=e.method;return _.debug("receiveNotification() [method:%s, notification:%o]",r,e),Promise.resolve().then(function(){switch(r){case"closed":var n=e.appData;t.remoteClose(n);break;case"transportClosed":var o=e.id,a=e.appData,i=t._transports.get(o);if(!i)throw new Error('Transport not found [id:"'.concat(o,'"]'));i.remoteClose(a);break;case"transportStats":var s=e.id,c=e.stats,u=t._transports.get(s);if(!u)throw new Error("transport not found [id:".concat(s,"]"));u.remoteStats(c);break;case"newPeer":var d=e.name;if(t._peers.has(d))throw new Error('Peer already exists [name:"'.concat(d,'"]'));var l=e;t._handlePeerData(l);break;case"peerClosed":var p=e.name,f=e.appData,m=t._peers.get(p);if(!m)throw new Error('no Peer found [name:"'.concat(p,'"]'));m.remoteClose(f);break;case"producerPaused":var h=e.id,v=e.appData,y=t._producers.get(h);if(!y)throw new Error("Producer not found [id:".concat(h,"]"));y.remotePause(v);break;case"producerResumed":var _=e.id,g=e.appData,b=t._producers.get(_);if(!b)throw new Error("Producer not found [id:".concat(_,"]"));b.remoteResume(g);break;case"producerClosed":var P=e.id,w=e.appData,k=t._producers.get(P);if(!k)throw new Error("Producer not found [id:".concat(P,"]"));k.remoteClose(w);break;case"producerStats":var S=e.id,T=e.stats,R=t._producers.get(S);if(!R)throw new Error("Producer not found [id:".concat(S,"]"));R.remoteStats(T);break;case"newConsumer":var C=e.peerName,E=t._peers.get(C);if(!E)throw new Error('no Peer found [name:"'.concat(C,'"]'));var O=e;t._handleConsumerData(O,E);break;case"consumerClosed":var x=e.id,j=e.peerName,D=e.appData,I=t._peers.get(j);if(!I)throw new Error('no Peer found [name:"'.concat(j,'"]'));var L=I.getConsumerById(x);if(!L)throw new Error("Consumer not found [id:".concat(x,"]"));L.remoteClose(D);break;case"consumerPaused":var F=e.id,A=e.peerName,M=e.appData,B=t._peers.get(A);if(!B)throw new Error('no Peer found [name:"'.concat(A,'"]'));var N=B.getConsumerById(F);if(!N)throw new Error("Consumer not found [id:".concat(F,"]"));N.remotePause(M);break;case"consumerResumed":var U=e.id,q=e.peerName,z=e.appData,G=t._peers.get(q);if(!G)throw new Error('no Peer found [name:"'.concat(q,'"]'));var K=G.getConsumerById(U);if(!K)throw new Error("Consumer not found [id:".concat(U,"]"));K.remoteResume(z);break;case"consumerPreferredProfileSet":var V=e.id,W=e.peerName,Q=e.profile,$=t._peers.get(W);if(!$)throw new Error('no Peer found [name:"'.concat(W,'"]'));var J=$.getConsumerById(V);if(!J)throw new Error("Consumer not found [id:".concat(V,"]"));J.remoteSetPreferredProfile(Q);break;case"consumerEffectiveProfileChanged":var H=e.id,X=e.peerName,Z=e.profile,Y=t._peers.get(X);if(!Y)throw new Error('no Peer found [name:"'.concat(X,'"]'));var ee=Y.getConsumerById(H);if(!ee)throw new Error("Consumer not found [id:".concat(H,"]"));ee.remoteEffectiveProfileChanged(Z);break;case"consumerStats":var te=e.id,re=e.peerName,ne=e.stats,oe=t._peers.get(re);if(!oe)throw new Error('no Peer found [name:"'.concat(re,'"]'));var ae=oe.getConsumerById(te);if(!ae)throw new Error("Consumer not found [id:".concat(te,"]"));ae.remoteStats(ne);break;default:throw new Error('unknown notification method "'.concat(r,'"'))}}).catch(function(t){_.error("receiveNotification() failed [notification:%o]: %s",e,t)})}},{key:"_sendRequest",value:function(e,t){var r=this,n=Object.assign({method:e,target:"peer"},t);return this.closed?(_.error("_sendRequest() | Room closed [method:%s, request:%o]",e,n),Promise.reject(new a.InvalidStateError("Room closed"))):(_.debug("_sendRequest() [method:%s, request:%o]",e,n),new Promise(function(t,o){var i=!1,s=setTimeout(function(){_.error("request failed [method:%s]: timeout",e),i=!0,o(new a.TimeoutError("timeout"))},r._settings.requestTimeout);r.safeEmit("request",n,function(n){if(!i){if(i=!0,clearTimeout(s),r.closed)return _.error("request failed [method:%s]: Room closed",e),void o(new Error("Room closed"));_.debug("request succeeded [method:%s, response:%o]",e,n),t(n)}},function(t){if(!i){if(i=!0,clearTimeout(s),r.closed)return _.error("request failed [method:%s]: Room closed",e),void o(new Error("Room closed"));t instanceof Error||(t=new Error(String(t))),_.error("request failed [method:%s]:%o",e,t),o(t)}})}))}},{key:"_sendNotification",value:function(e,t){if(!this.closed){var r=Object.assign({method:e,target:"peer",notification:!0},t);_.debug("_sendNotification() [method:%s, notification:%o]",e,r),this.safeEmit("notify",r)}}},{key:"_handlePeerData",value:function(e){var t=this,r=e.name,n=e.consumers,o=e.appData,a=new d.default(r,o);this._peers.set(a.name,a),a.on("@close",function(){t._peers.delete(a.name)});var i=!0,s=!1,c=void 0;try{for(var u,l=n[Symbol.iterator]();!(i=(u=l.next()).done);i=!0){var p=u.value;try{this._handleConsumerData(p,a)}catch(e){_.error("error handling existing Consumer in Peer:%o",e)}}}catch(e){s=!0,c=e}finally{try{i||null==l.return||l.return()}finally{if(s)throw c}}this.joined&&this.safeEmit("newpeer",a)}},{key:"_handleConsumerData",value:function(e,t){var r=e.id,n=e.kind,o=e.rtpParameters,a=e.paused,s=e.appData,c=new l.default(r,n,o,t,s);i.canReceive(c.rtpParameters,this._extendedRtpCapabilities)&&c.setSupported(!0),a&&c.remotePause(),t.addConsumer(c)}},{key:"joined",get:function(){return this._state===g.joined}},{key:"closed",get:function(){return this._state===g.closed}},{key:"peerName",get:function(){return this._peerName}},{key:"transports",get:function(){return Array.from(this._transports.values())}},{key:"producers",get:function(){return Array.from(this._producers.values())}},{key:"peers",get:function(){return Array.from(this._peers.values())}}])&&m(r.prototype,n),p&&m(r,p),t}();r.default=b},{"./Consumer":2,"./Device":3,"./EnhancedEventEmitter":4,"./Logger":5,"./Peer":6,"./Producer":7,"./Transport":9,"./errors":10,"./ortc":26}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=u(e("./Logger")),o=u(e("./EnhancedEventEmitter")),a=e("./errors"),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(e("./utils")),s=u(e("./Device")),c=u(e("./CommandQueue"));function u(e){return e&&e.__esModule?e:{default:e}}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var h=new n.default("Transport"),v=function(e){function t(e,r,n,o){var a,u,l;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),u=this,a=!(l=p(t).call(this,h))||"object"!==d(l)&&"function"!=typeof l?m(u):l,h.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",e,r),a._id=i.randomNumber(),a._closed=!1,a._direction=e,a._settings=n,a._appData=o,a._statsEnabled=!1,a._commandQueue=new c.default,a._handler=new s.default.Handler(e,r,n),a._connectionState="new",a._commandQueue.on("exec",a._execCommand.bind(m(m(a)))),a._handleHandler(),a}var r,n,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,o.default),r=t,(n=[{key:"close",value:function(e){h.debug("close()"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.disableStats()),this.safeEmit("@notify","closeTransport",{id:this._id,appData:e}),this.emit("@close"),this.safeEmit("close","local",e),this._destroy())}},{key:"remoteClose",value:function(e){h.debug("remoteClose()"),this._closed||(this._closed=!0,this.emit("@close"),this.safeEmit("close","remote",e),this._destroy())}},{key:"_destroy",value:function(){this._commandQueue.close(),this._handler.close()}},{key:"restartIce",value:function(){var e=this;h.debug("restartIce()"),this._closed||"new"!==this._connectionState&&Promise.resolve().then(function(){var t={id:e._id};return e.safeEmitAsPromise("@request","restartTransport",t)}).then(function(t){var r=t.iceParameters;return e._commandQueue.push("restartIce",{remoteIceParameters:r})}).catch(function(e){h.error("restartIce() | failed: %o",e)})}},{key:"enableStats",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;h.debug("enableStats() [interval:%s]",e),("number"!=typeof e||e<1e3)&&(e=1e3),this._statsEnabled=!0;var t={id:this._id,interval:e};this.safeEmit("@notify","enableTransportStats",t)}},{key:"disableStats",value:function(){h.debug("disableStats()"),this._statsEnabled=!1;var e={id:this._id};this.safeEmit("@notify","disableTransportStats",e)}},{key:"_handleHandler",value:function(){var e=this,t=this._handler;t.on("@connectionstatechange",function(t){e._connectionState!==t&&(h.debug("Transport connection state changed to %s",t),e._connectionState=t,e._closed||e.safeEmit("connectionstatechange",t))}),t.on("@needcreatetransport",function(t,r,n){var o={id:e._id,direction:e._direction,options:e._settings.transportOptions,appData:e._appData};t&&(o.dtlsParameters=t.dtlsParameters),e.safeEmit("@request","createTransport",o,r,n)}),t.on("@needupdatetransport",function(t){var r={id:e._id,dtlsParameters:t.dtlsParameters};e.safeEmit("@notify","updateTransport",r)}),t.on("@needupdateproducer",function(t,r){var n={id:t.id,rtpParameters:r};t.setRtpParameters(r),e.safeEmit("@notify","updateProducer",n)})}},{key:"addProducer",value:function(e){return h.debug("addProducer() [producer:%o]",e),this._closed?Promise.reject(new a.InvalidStateError("Transport closed")):"send"!==this._direction?Promise.reject(new Error("not a sending Transport")):this._commandQueue.push("addProducer",{producer:e})}},{key:"removeProducer",value:function(e,t,r){h.debug("removeProducer() [producer:%o]",e),this._closed||this._commandQueue.push("removeProducer",{producer:e}).catch(function(){}),"local"===t&&this.safeEmit("@notify","closeProducer",{id:e.id,appData:r})}},{key:"pauseProducer",value:function(e,t){h.debug("pauseProducer() [producer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","pauseProducer",r)}},{key:"resumeProducer",value:function(e,t){h.debug("resumeProducer() [producer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","resumeProducer",r)}},{key:"replaceProducerTrack",value:function(e,t){return h.debug("replaceProducerTrack() [producer:%o]",e),this._commandQueue.push("replaceProducerTrack",{producer:e,track:t})}},{key:"enableProducerStats",value:function(e,t){h.debug("enableProducerStats() [producer:%o]",e);var r={id:e.id,interval:t};this.safeEmit("@notify","enableProducerStats",r)}},{key:"disableProducerStats",value:function(e){h.debug("disableProducerStats() [producer:%o]",e);var t={id:e.id};this.safeEmit("@notify","disableProducerStats",t)}},{key:"addConsumer",value:function(e){return h.debug("addConsumer() [consumer:%o]",e),this._closed?Promise.reject(new a.InvalidStateError("Transport closed")):"recv"!==this._direction?Promise.reject(new Error("not a receiving Transport")):this._commandQueue.push("addConsumer",{consumer:e})}},{key:"removeConsumer",value:function(e){h.debug("removeConsumer() [consumer:%o]",e),this._commandQueue.push("removeConsumer",{consumer:e}).catch(function(){})}},{key:"pauseConsumer",value:function(e,t){h.debug("pauseConsumer() [consumer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","pauseConsumer",r)}},{key:"resumeConsumer",value:function(e,t){h.debug("resumeConsumer() [consumer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","resumeConsumer",r)}},{key:"setConsumerPreferredProfile",value:function(e,t){h.debug("setConsumerPreferredProfile() [consumer:%o]",e);var r={id:e.id,profile:t};this.safeEmit("@notify","setConsumerPreferredProfile",r)}},{key:"enableConsumerStats",value:function(e,t){h.debug("enableConsumerStats() [consumer:%o]",e);var r={id:e.id,interval:t};this.safeEmit("@notify","enableConsumerStats",r)}},{key:"disableConsumerStats",value:function(e){h.debug("disableConsumerStats() [consumer:%o]",e);var t={id:e.id};this.safeEmit("@notify","disableConsumerStats",t)}},{key:"remoteStats",value:function(e){this.safeEmit("stats",e)}},{key:"_execCommand",value:function(e,t){var r;try{switch(e.method){case"addProducer":var n=e.producer;r=this._execAddProducer(n);break;case"removeProducer":var o=e.producer;r=this._execRemoveProducer(o);break;case"replaceProducerTrack":var a=e.producer,i=e.track;r=this._execReplaceProducerTrack(a,i);break;case"addConsumer":var s=e.consumer;r=this._execAddConsumer(s);break;case"removeConsumer":var c=e.consumer;r=this._execRemoveConsumer(c);break;case"restartIce":var u=e.remoteIceParameters;r=this._execRestartIce(u);break;default:r=Promise.reject(new Error('unknown command method "'.concat(e.method,'"')))}}catch(e){r=Promise.reject(e)}t.promise=r}},{key:"_execAddProducer",value:function(e){var t,r=this;return h.debug("_execAddProducer()"),Promise.resolve().then(function(){return r._handler.addProducer(e)}).then(function(n){t=n;var o={id:e.id,kind:e.kind,transportId:r._id,rtpParameters:n,paused:e.locallyPaused,appData:e.appData};return r.safeEmitAsPromise("@request","createProducer",o)}).then(function(){e.setRtpParameters(t)})}},{key:"_execRemoveProducer",value:function(e){return h.debug("_execRemoveProducer()"),this._handler.removeProducer(e)}},{key:"_execReplaceProducerTrack",value:function(e,t){return h.debug("_execReplaceProducerTrack()"),this._handler.replaceProducerTrack(e,t)}},{key:"_execAddConsumer",value:function(e){var t,r=this;return h.debug("_execAddConsumer()"),Promise.resolve().then(function(){return r._handler.addConsumer(e)}).then(function(n){t=n;var o={id:e.id,transportId:r.id,paused:e.locallyPaused,preferredProfile:e.preferredProfile};return r.safeEmitAsPromise("@request","enableConsumer",o)}).then(function(r){var n=r.paused,o=r.preferredProfile,a=r.effectiveProfile;return n&&e.remotePause(),o&&e.remoteSetPreferredProfile(o),a&&e.remoteEffectiveProfileChanged(a),t})}},{key:"_execRemoveConsumer",value:function(e){return h.debug("_execRemoveConsumer()"),this._handler.removeConsumer(e)}},{key:"_execRestartIce",value:function(e){return h.debug("_execRestartIce()"),this._handler.restartIce(e)}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"direction",get:function(){return this._direction}},{key:"appData",get:function(){return this._appData}},{key:"connectionState",get:function(){return this._connectionState}}])&&l(r.prototype,n),u&&l(r,u),t}();r.default=v},{"./CommandQueue":1,"./Device":3,"./EnhancedEventEmitter":4,"./Logger":5,"./errors":10,"./utils":27}],10:[function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?s(e):t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e){var t="function"==typeof Map?new Map:void 0;return(c=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return u(e,arguments,l(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),d(n,e)})(e)}function u(e,t,r){return(u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&d(o,r.prototype),o}).apply(null,arguments)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.UnsupportedError=r.TimeoutError=r.InvalidStateError=void 0;var p,f,m,h,v=(p=Object,f=p.getPrototypeOf||function(e){return e.__proto__},m=p.setPrototypeOf||function(e,t){return e.__proto__=t,e},h="object"===("undefined"==typeof Reflect?"undefined":n(Reflect))?Reflect.construct:function(e,t,r){var n,o=[null];return o.push.apply(o,t),n=e.bind.apply(e,o),m(new n,r.prototype)},function(e){var t=f(e);return m(e,m(function(){return h(t,arguments,f(this).constructor)},t))}),y=v(function(e){function t(e){var r;return o(this,t),(r=a(this,l(t).call(this,e))).name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(s(s(r)),t):r.stack=new Error(e).stack,r}return i(t,c(Error)),t}());r.InvalidStateError=y;var _=v(function(e){function t(e){var r;return o(this,t),(r=a(this,l(t).call(this,e))).name="TimeoutError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(s(s(r)),y):r.stack=new Error(e).stack,r}return i(t,c(Error)),t}());r.TimeoutError=_;var g=v(function(e){function t(e,r){var n;return o(this,t),(n=a(this,l(t).call(this,e))).name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(s(s(n)),y):n.stack=new Error(e).stack,n.data=r,n}return i(t,c(Error)),t}());r.UnsupportedError=g},{}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=p(e("sdp-transform")),o=p(e("../Logger")),a=p(e("../EnhancedEventEmitter")),i=l(e("../utils")),s=l(e("../ortc")),c=l(e("./sdp/commonUtils")),u=l(e("./sdp/planBUtils")),d=p(e("./sdp/RemotePlanBSdp"));function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}function p(e){return e&&e.__esModule?e:{default:e}}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t,r){return t&&h(e.prototype,t),r&&h(e,r),e}function y(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var P=new o.default("Chrome55"),w=function(e){function t(e,r,n){var o;return m(this,t),(o=y(this,_(t).call(this,P)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new d.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return g(t,a.default),v(t,[{key:"close",value:function(){P.debug("close()");try{this._pc.close()}catch(e){}}}]),t}(),k=function(e){function t(e,r){var n;return m(this,t),(n=y(this,_(t).call(this,"send",e,r)))._transportReady=!1,n._stream=new MediaStream,n}return g(t,w),v(t,[{key:"addProducer",value:function(e){var t,r=this,o=e.track;return P.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,o.id),this._stream.getTrackById(o.id)?Promise.reject(new Error("track already added")):Promise.resolve().then(function(){return r._stream.addTrack(o),r._pc.addStream(r._stream),r._pc.createOffer()}).then(function(t){if(e.simulcast){P.debug("addProducer() | enabling simulcast");var a=n.default.parse(t.sdp);u.addSimulcastForTrack(a,o),t={type:"offer",sdp:n.default.write(a)}}return P.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",t),r._pc.setLocalDescription(t)}).then(function(){if(!r._transportReady)return r._setupTransport()}).then(function(){t=n.default.parse(r._pc.localDescription.sdp);var e={type:"answer",sdp:r._remoteSdp.createAnswerSdp(t)};return P.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),r._pc.setRemoteDescription(e)}).then(function(){var n=i.clone(r._rtpParametersByKind[e.kind]);return u.fillRtpParametersForTrack(n,t,o),n}).catch(function(e){throw r._stream.removeTrack(o),r._pc.addStream(r._stream),e})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return P.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){return t._stream.removeTrack(r),t._pc.addStream(t._stream),t._pc.createOffer()}).then(function(e){return P.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).catch(function(e){if(0!==t._stream.getTracks().length)throw e;P.warn("removeProducer() | ignoring expected error due no sending tracks: %s",e.toString())}).then(function(){if("stable"!==t._pc.signalingState){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;P.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var o,a=e.track;return Promise.resolve().then(function(){return r._stream.removeTrack(a),r._stream.addTrack(t),r._pc.addStream(r._stream),r._pc.createOffer()}).then(function(o){if(e.simulcast){P.debug("addProducer() | enabling simulcast");var a=n.default.parse(o.sdp);u.addSimulcastForTrack(a,t),o={type:"offer",sdp:n.default.write(a)}}return P.debug("replaceProducerTrack() | calling pc.setLocalDescription() [offer:%o]",o),r._pc.setLocalDescription(o)}).then(function(){o=n.default.parse(r._pc.localDescription.sdp);var e={type:"answer",sdp:r._remoteSdp.createAnswerSdp(o)};return P.debug("replaceProducerTrack() | calling pc.setRemoteDescription() [answer:%o]",e),r._pc.setRemoteDescription(e)}).then(function(){var n=i.clone(r._rtpParametersByKind[e.kind]);u.fillRtpParametersForTrack(n,o,t),r.safeEmit("@needupdateproducer",e,n)}).catch(function(e){throw r._stream.removeTrack(t),r._stream.addTrack(a),r._pc.addStream(r._stream),e})}},{key:"restartIce",value:function(e){var t=this;return P.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return P.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})}},{key:"_setupTransport",value:function(){var e=this;return P.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,o=n.default.parse(r),a=c.extractDtlsParameters(o);return a.role="server",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(),S=function(e){function t(e,r){var n;return m(this,t),(n=y(this,_(t).call(this,"recv",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._kinds=new Set,n._consumerInfos=new Map,n}return g(t,w),v(t,[{key:"addConsumer",value:function(e){var t=this;if(P.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:"recv-stream-".concat(e.id),trackId:"consumer-".concat(e.kind,"-").concat(e.id),ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return P.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getRemoteStreams().find(function(e){return e.id===o.streamId}).getTrackById(o.trackId);if(!e)throw new Error("remote track not found");return e})}},{key:"removeConsumer",value:function(e){var t=this;return P.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return P.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return P.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return P.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return P.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){P.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=n.default.parse(e),r={dtlsParameters:c.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(),T=function(){function e(t,r,n){var o;switch(m(this,e),P.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r),t){case"send":return o={audio:s.getSendingRtpParameters("audio",r),video:s.getSendingRtpParameters("video",r)},new k(o,n);case"recv":return o={audio:s.getReceivingFullRtpParameters("audio",r),video:s.getReceivingFullRtpParameters("video",r)},new S(o,n)}}return v(e,null,[{key:"getNativeRtpCapabilities",value:function(){P.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(t){try{e.close()}catch(e){}var r=n.default.parse(t.sdp);return c.extractRtpCapabilities(r)}).catch(function(t){try{e.close()}catch(e){}throw t})}},{key:"tag",get:function(){return"Chrome55"}}]),e}();r.default=T},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":26,"../utils":27,"./sdp/RemotePlanBSdp":20,"./sdp/commonUtils":22,"./sdp/planBUtils":23,"sdp-transform":36}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=p(e("sdp-transform")),o=p(e("../Logger")),a=p(e("../EnhancedEventEmitter")),i=l(e("../utils")),s=l(e("../ortc")),c=l(e("./sdp/commonUtils")),u=l(e("./sdp/planBUtils")),d=p(e("./sdp/RemotePlanBSdp"));function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}function p(e){return e&&e.__esModule?e:{default:e}}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t,r){return t&&h(e.prototype,t),r&&h(e,r),e}function y(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var P=new o.default("Chrome67"),w=function(e){function t(e,r,n){var o;return m(this,t),(o=y(this,_(t).call(this,P)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"}),o._rtpParametersByKind=r,o._remoteSdp=new d.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return g(t,a.default),v(t,[{key:"close",value:function(){P.debug("close()");try{this._pc.close()}catch(e){}}}]),t}(),k=function(e){function t(e,r){var n;return m(this,t),(n=y(this,_(t).call(this,"send",e,r)))._transportReady=!1,n._stream=new MediaStream,n}return g(t,w),v(t,[{key:"addProducer",value:function(e){var t,r=this,o=e.track;return P.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,o.id),this._stream.getTrackById(o.id)?Promise.reject(new Error("track already added")):Promise.resolve().then(function(){return r._stream.addTrack(o),r._pc.addStream(r._stream),r._pc.createOffer()}).then(function(t){if(e.simulcast){P.debug("addProducer() | enabling simulcast");var a=n.default.parse(t.sdp);u.addSimulcastForTrack(a,o),t={type:"offer",sdp:n.default.write(a)}}return P.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",t),r._pc.setLocalDescription(t)}).then(function(){if(!r._transportReady)return r._setupTransport()}).then(function(){t=n.default.parse(r._pc.localDescription.sdp);var e={type:"answer",sdp:r._remoteSdp.createAnswerSdp(t)};return P.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),r._pc.setRemoteDescription(e)}).then(function(){var n=i.clone(r._rtpParametersByKind[e.kind]);return u.fillRtpParametersForTrack(n,t,o),n}).catch(function(e){throw r._stream.removeTrack(o),r._pc.addStream(r._stream),e})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return P.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){return t._stream.removeTrack(r),t._pc.addStream(t._stream),t._pc.createOffer()}).then(function(e){return P.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).catch(function(e){if(0!==t._stream.getTracks().length)throw e;P.warn("removeProducer() | ignoring expected error due no sending tracks: %s",e.toString())}).then(function(){if("stable"!==t._pc.signalingState){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;P.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===n});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){r._stream.removeTrack(n),r._stream.addTrack(t)})}},{key:"restartIce",value:function(e){var t=this;return P.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return P.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})}},{key:"_setupTransport",value:function(){var e=this;return P.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,o=n.default.parse(r),a=c.extractDtlsParameters(o);return a.role="server",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(),S=function(e){function t(e,r){var n;return m(this,t),(n=y(this,_(t).call(this,"recv",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._kinds=new Set,n._consumerInfos=new Map,n}return g(t,w),v(t,[{key:"addConsumer",value:function(e){var t=this;if(P.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:"recv-stream-".concat(e.id),trackId:"consumer-".concat(e.kind,"-").concat(e.id),ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return P.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getRemoteStreams().find(function(e){return e.id===o.streamId}).getTrackById(o.trackId);if(!e)throw new Error("remote track not found");return e})}},{key:"removeConsumer",value:function(e){var t=this;return P.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return P.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return P.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return P.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return P.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){P.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=n.default.parse(e),r={dtlsParameters:c.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(),T=function(){function e(t,r,n){var o;switch(m(this,e),P.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r),t){case"send":return o={audio:s.getSendingRtpParameters("audio",r),video:s.getSendingRtpParameters("video",r)},new k(o,n);case"recv":return o={audio:s.getReceivingFullRtpParameters("audio",r),video:s.getReceivingFullRtpParameters("video",r)},new S(o,n)}}return v(e,null,[{key:"getNativeRtpCapabilities",value:function(){P.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(t){try{e.close()}catch(e){}var r=n.default.parse(t.sdp);return c.extractRtpCapabilities(r)}).catch(function(t){try{e.close()}catch(e){}throw t})}},{key:"tag",get:function(){return"Chrome67"}}]),e}();r.default=T},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":26,"../utils":27,"./sdp/RemotePlanBSdp":20,"./sdp/commonUtils":22,"./sdp/planBUtils":23,"sdp-transform":36}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=p(e("sdp-transform")),o=p(e("../Logger")),a=p(e("../EnhancedEventEmitter")),i=l(e("../utils")),s=l(e("../ortc")),c=l(e("./sdp/commonUtils")),u=l(e("./sdp/planBUtils")),d=p(e("./sdp/RemotePlanBSdp"));function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}function p(e){return e&&e.__esModule?e:{default:e}}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t,r){return t&&h(e.prototype,t),r&&h(e,r),e}function y(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var P=new o.default("Chrome69"),w=function(e){function t(e,r,n){var o;return m(this,t),(o=y(this,_(t).call(this,P)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"}),o._rtpParametersByKind=r,o._remoteSdp=new d.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return g(t,a.default),v(t,[{key:"close",value:function(){P.debug("close()");try{this._pc.close()}catch(e){}}}]),t}(),k=function(e){function t(e,r){var n;return m(this,t),(n=y(this,_(t).call(this,"send",e,r)))._transportReady=!1,n._stream=new MediaStream,n}return g(t,w),v(t,[{key:"addProducer",value:function(e){var t,r,o=this,a=e.track;return P.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,a.id),this._stream.getTrackById(a.id)?Promise.reject(new Error("track already added")):Promise.resolve().then(function(){return o._stream.addTrack(a),t=o._pc.addTrack(a,o._stream),o._pc.createOffer()}).then(function(t){if(e.simulcast){P.debug("addProducer() | enabling simulcast");var r=n.default.parse(t.sdp);u.addSimulcastForTrack(r,a),t={type:"offer",sdp:n.default.write(r)}}return P.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",t),o._pc.setLocalDescription(t)}).then(function(){if(!o._transportReady)return o._setupTransport()}).then(function(){r=n.default.parse(o._pc.localDescription.sdp);var e={type:"answer",sdp:o._remoteSdp.createAnswerSdp(r)};return P.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),o._pc.setRemoteDescription(e)}).then(function(){var t=i.clone(o._rtpParametersByKind[e.kind]);return u.fillRtpParametersForTrack(t,r,a),t}).catch(function(e){try{o._pc.removeTrack(t)}catch(e){}throw o._stream.removeTrack(a),e})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return P.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){var e=t._pc.getSenders().find(function(e){return e.track===r});if(!e)throw new Error("RTCRtpSender found");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()}).then(function(e){return P.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).catch(function(e){if(0!==t._stream.getTracks().length)throw e;P.warn("removeProducer() | ignoring expected error due no sending tracks: %s",e.toString())}).then(function(){if("stable"!==t._pc.signalingState){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;P.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===n});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){r._stream.removeTrack(n),r._stream.addTrack(t)})}},{key:"restartIce",value:function(e){var t=this;return P.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return P.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})}},{key:"_setupTransport",value:function(){var e=this;return P.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,o=n.default.parse(r),a=c.extractDtlsParameters(o);return a.role="server",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(),S=function(e){function t(e,r){var n;return m(this,t),(n=y(this,_(t).call(this,"recv",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._kinds=new Set,n._consumerInfos=new Map,n}return g(t,w),v(t,[{key:"addConsumer",value:function(e){var t=this;if(P.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:"recv-stream-".concat(e.id),trackId:"consumer-".concat(e.kind,"-").concat(e.id),ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return P.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getReceivers().find(function(e){var t=e.track;return!!t&&t.id===o.trackId});if(!e)throw new Error("remote track not found");return e.track})}},{key:"removeConsumer",value:function(e){var t=this;return P.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return P.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return P.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return P.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return P.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){P.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=n.default.parse(e),r={dtlsParameters:c.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(),T=function(){function e(t,r,n){var o;switch(m(this,e),P.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r),t){case"send":return o={audio:s.getSendingRtpParameters("audio",r),video:s.getSendingRtpParameters("video",r)},new k(o,n);case"recv":return o={audio:s.getReceivingFullRtpParameters("audio",r),video:s.getReceivingFullRtpParameters("video",r)},new S(o,n)}}return v(e,null,[{key:"getNativeRtpCapabilities",value:function(){P.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(t){try{e.close()}catch(e){}var r=n.default.parse(t.sdp);return c.extractRtpCapabilities(r)}).catch(function(t){try{e.close()}catch(e){}throw t})}},{key:"tag",get:function(){return"Chrome69"}}]),e}();r.default=T},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":26,"../utils":27,"./sdp/RemotePlanBSdp":20,"./sdp/commonUtils":22,"./sdp/planBUtils":23,"sdp-transform":36}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=u(e("../Logger")),o=u(e("../EnhancedEventEmitter")),a=c(e("../utils")),i=c(e("../ortc")),s=c(e("./ortc/edgeUtils"));function c(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}function u(e){return e&&e.__esModule?e:{default:e}}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t,r){return t&&f(e.prototype,t),r&&f(e,r),e}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v="CNAME-EDGE-".concat(a.randomNumber()),y=new n.default("Edge11"),_=function(e){function t(e,r,n){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=l(this,p(t).call(this,y)),y.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",e,r),o._rtpParametersByKind={audio:i.getSendingRtpParameters("audio",r),video:i.getSendingRtpParameters("video",r)},o._transportReady=!1,o._iceGatherer=null,o._iceTransport=null,o._dtlsTransport=null,o._rtpSenders=new Map,o._rtpReceivers=new Map,o._transportRemoteParameters=null,o._setIceGatherer(n),o._setIceTransport(),o._setDtlsTransport(),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,o.default),m(t,null,[{key:"getNativeRtpCapabilities",value:function(){return y.debug("getNativeRtpCapabilities()"),Promise.resolve(s.getCapabilities())}},{key:"tag",get:function(){return"Edge11"}}]),m(t,[{key:"close",value:function(){y.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}var e=!0,t=!1,r=void 0;try{for(var n,o=this._rtpSenders.values()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var a=n.value;try{a.stop()}catch(e){}}}catch(e){t=!0,r=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw r}}var i=!0,s=!1,c=void 0;try{for(var u,d=this._rtpReceivers.values()[Symbol.iterator]();!(i=(u=d.next()).done);i=!0){var l=u.value;try{l.stop()}catch(e){}}}catch(e){s=!0,c=e}finally{try{i||null==d.return||d.return()}finally{if(s)throw c}}}},{key:"addProducer",value:function(e){var t=this,r=e.track;return y.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._rtpSenders.has(e.id)?Promise.reject(new Error("Producer already added")):Promise.resolve().then(function(){if(!t._transportReady)return t._setupTransport()}).then(function(){y.debug("addProducer() | calling new RTCRtpSender()");var n=new RTCRtpSender(r,t._dtlsTransport),o=a.clone(t._rtpParametersByKind[e.kind]),i={ssrc:a.randomNumber()};o.codecs.some(function(e){return"rtx"===e.name})&&(i.rtx={ssrc:a.randomNumber()}),o.encodings.push(i),o.rtcp={cname:v,reducedSize:!0,mux:!0};var c=s.mangleRtpParameters(o);return y.debug("addProducer() | calling rtpSender.send() [params:%o]",c),n.send(c),t._rtpSenders.set(e.id,n),o})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return y.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){var r=t._rtpSenders.get(e.id);if(!r)throw new Error("RTCRtpSender not found");t._rtpSenders.delete(e.id);try{y.debug("removeProducer() | calling rtpSender.stop()"),r.stop()}catch(e){y.warn("rtpSender.stop() failed:%o",e)}})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;return y.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id),Promise.resolve().then(function(){var n=r._rtpSenders.get(e.id);if(!n)throw new Error("RTCRtpSender not found");n.setTrack(t)})}},{key:"addConsumer",value:function(e){var t=this;return y.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._rtpReceivers.has(e.id)?Promise.reject(new Error("Consumer already added")):Promise.resolve().then(function(){if(!t._transportReady)return t._setupTransport()}).then(function(){y.debug("addProducer() | calling new RTCRtpReceiver()");var r=new RTCRtpReceiver(t._dtlsTransport,e.kind);r.addEventListener("error",function(e){y.error('iceGatherer "error" event [event:%o]',e)});var n=s.mangleRtpParameters(e.rtpParameters);return y.debug("addProducer() | calling rtpReceiver.receive() [params:%o]",n),r.receive(n),t._rtpReceivers.set(e.id,r),r.track})}},{key:"removeConsumer",value:function(e){var t=this;return y.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),Promise.resolve().then(function(){var r=t._rtpReceivers.get(e.id);if(!r)throw new Error("RTCRtpReceiver not found");t._rtpReceivers.delete(e.id);try{y.debug("removeConsumer() | calling rtpReceiver.stop()"),r.stop()}catch(e){y.warn("rtpReceiver.stop() failed:%o",e)}})}},{key:"restartIce",value:function(e){var t=this;y.debug("restartIce()"),Promise.resolve().then(function(){t._transportRemoteParameters.iceParameters=e;var r=t._transportRemoteParameters.iceCandidates;y.debug("restartIce() | calling iceTransport.start()"),t._iceTransport.start(t._iceGatherer,e,"controlling");var n=!0,o=!1,a=void 0;try{for(var i,s=r[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var c=i.value;t._iceTransport.addRemoteCandidate(c)}}catch(e){o=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}t._iceTransport.addRemoteCandidate({})})}},{key:"_setIceGatherer",value:function(e){var t=new RTCIceGatherer({iceServers:e.turnServers||[],gatherPolicy:e.iceTransportPolicy});t.addEventListener("error",function(e){y.error('iceGatherer "error" event [event:%o]',e)});try{t.gather()}catch(e){y.debug("iceGatherer.gather() failed: %s",e.toString())}this._iceGatherer=t}},{key:"_setIceTransport",value:function(){var e=this,t=new RTCIceTransport(this._iceGatherer);t.addEventListener("statechange",function(){switch(t.state){case"checking":e.emit("@connectionstatechange","connecting");break;case"connected":case"completed":e.emit("@connectionstatechange","connected");break;case"failed":e.emit("@connectionstatechange","failed");break;case"disconnected":e.emit("@connectionstatechange","disconnected");break;case"closed":e.emit("@connectionstatechange","closed")}}),t.addEventListener("icestatechange",function(){switch(t.state){case"checking":e.emit("@connectionstatechange","connecting");break;case"connected":case"completed":e.emit("@connectionstatechange","connected");break;case"failed":e.emit("@connectionstatechange","failed");break;case"disconnected":e.emit("@connectionstatechange","disconnected");break;case"closed":e.emit("@connectionstatechange","closed")}}),t.addEventListener("candidatepairchange",function(e){y.debug('iceTransport "candidatepairchange" event [pair:%o]',e.pair)}),this._iceTransport=t}},{key:"_setDtlsTransport",value:function(){var e=new RTCDtlsTransport(this._iceTransport);e.addEventListener("statechange",function(){y.debug('dtlsTransport "statechange" event [state:%s]',e.state)}),e.addEventListener("dtlsstatechange",function(){y.debug('dtlsTransport "dtlsstatechange" event [state:%s]',e.state)}),e.addEventListener("error",function(e){y.error('dtlsTransport "error" event [event:%o]',e)}),this._dtlsTransport=e}},{key:"_setupTransport",value:function(){var e=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._dtlsTransport.getLocalParameters();return r.role="server",t.dtlsParameters=r,e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._transportRemoteParameters=t;var r=t.iceParameters,n=t.iceCandidates,o=t.dtlsParameters;e._iceTransport.start(e._iceGatherer,r,"controlling");var a=!0,i=!1,s=void 0;try{for(var c,u=n[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var d=c.value;e._iceTransport.addRemoteCandidate(d)}}catch(e){i=!0,s=e}finally{try{a||null==u.return||u.return()}finally{if(i)throw s}}e._iceTransport.addRemoteCandidate({}),o.fingerprints=o.fingerprints.filter(function(e){return"sha-256"===e.algorithm||"sha-384"===e.algorithm||"sha-512"===e.algorithm}),e._dtlsTransport.start(o),e._transportReady=!0})}}]),t}();r.default=_},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":26,"../utils":27,"./ortc/edgeUtils":19}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=p(e("sdp-transform")),o=p(e("../Logger")),a=p(e("../EnhancedEventEmitter")),i=l(e("../utils")),s=l(e("../ortc")),c=l(e("./sdp/commonUtils")),u=l(e("./sdp/unifiedPlanUtils")),d=p(e("./sdp/RemoteUnifiedPlanSdp"));function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}function p(e){return e&&e.__esModule?e:{default:e}}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t,r){return t&&h(e.prototype,t),r&&h(e,r),e}function y(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var P=new o.default("Firefox50"),w=function(e){function t(e,r,n){var o;return m(this,t),(o=y(this,_(t).call(this,P)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new d.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return g(t,a.default),v(t,[{key:"close",value:function(){P.debug("close()");try{this._pc.close()}catch(e){}}}]),t}(),k=function(e){function t(e,r){var n;return m(this,t),(n=y(this,_(t).call(this,"send",e,r)))._transportReady=!1,n._stream=new MediaStream,n._nextRid=1,n}return g(t,w),v(t,[{key:"addProducer",value:function(e){var t,r,o=this,a=e.track;return P.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,a.id),this._stream.getTrackById(a.id)?Promise.reject(new Error("track already added")):Promise.resolve().then(function(){o._stream.addTrack(a),t=o._pc.addTrack(a,o._stream)}).then(function(){if(e.simulcast){P.debug("addProducer() | enabling simulcast");var r=[];return e.simulcast.high&&r.push({rid:"high".concat(o._nextRid),active:!0,priority:"low",maxBitrate:e.simulcast.high}),e.simulcast.medium&&r.push({rid:"medium".concat(o._nextRid),active:!0,priority:"medium",maxBitrate:e.simulcast.medium}),e.simulcast.low&&r.push({rid:"low".concat(o._nextRid),active:!0,priority:"high",maxBitrate:e.simulcast.low}),o._nextRid++,t.setParameters({encodings:r})}}).then(function(){return o._pc.createOffer()}).then(function(e){return P.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",e),o._pc.setLocalDescription(e)}).then(function(){if(!o._transportReady)return o._setupTransport()}).then(function(){r=n.default.parse(o._pc.localDescription.sdp);var e={type:"answer",sdp:o._remoteSdp.createAnswerSdp(r)};return P.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),o._pc.setRemoteDescription(e)}).then(function(){var t=i.clone(o._rtpParametersByKind[e.kind]);return u.fillRtpParametersForTrack(t,r,a),t}).catch(function(e){try{o._pc.removeTrack(t)}catch(e){}throw o._stream.removeTrack(a),e})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return P.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){var e=t._pc.getSenders().find(function(e){return e.track===r});if(!e)throw new Error("RTCRtpSender found");return t._pc.removeTrack(e),t._stream.removeTrack(r),Promise.resolve().then(function(){return t._pc.createOffer()}).then(function(e){return P.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})}).then(function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;P.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===n});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){r._stream.removeTrack(n),r._stream.addTrack(t)})}},{key:"restartIce",value:function(e){var t=this;return P.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return P.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})}},{key:"_setupTransport",value:function(){var e=this;return P.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,o=n.default.parse(r),a=c.extractDtlsParameters(o);return a.role="server",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(),S=function(e){function t(e,r){var n;m(this,t),(n=y(this,_(t).call(this,"recv",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new Map;return n._consumerInfos.set(555,{mid:"fake-dc",kind:"application",closed:!1,cname:null}),n}return g(t,w),v(t,[{key:"addConsumer",value:function(e){var t=this;if(P.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={mid:"".concat(e.kind[0]).concat(e.id),kind:e.kind,closed:e.closed,streamId:"recv-stream-".concat(e.id),trackId:"consumer-".concat(e.kind,"-").concat(e.id),ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return P.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getReceivers().find(function(e){var t=e.track;return!!t&&t.id===o.trackId});if(!e)throw new Error("remote track not found");return e.track})}},{key:"removeConsumer",value:function(e){var t=this;P.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return P.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return P.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return P.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return P.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){P.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=n.default.parse(e),r={dtlsParameters:c.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(),T=function(){function e(t,r,n){var o;switch(m(this,e),P.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r),t){case"send":return o={audio:s.getSendingRtpParameters("audio",r),video:s.getSendingRtpParameters("video",r)},new k(o,n);case"recv":return o={audio:s.getReceivingFullRtpParameters("audio",r),video:s.getReceivingFullRtpParameters("video",r)},new S(o,n)}}return v(e,null,[{key:"getNativeRtpCapabilities",value:function(){P.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");var r=t.captureStream(),o=r.getVideoTracks()[0];return e.addTrack(o,r).setParameters({encodings:[{rid:"RID1",maxBitrate:4e4},{rid:"RID2",maxBitrate:1e4}]}),e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(r){try{t.remove()}catch(e){}try{o.stop()}catch(e){}try{e.close()}catch(e){}var a=n.default.parse(r.sdp);return c.extractRtpCapabilities(a)}).catch(function(r){try{t.remove()}catch(e){}try{o.stop()}catch(e){}try{e.close()}catch(e){}throw r})}},{key:"tag",get:function(){return"Firefox50"}}]),e}();r.default=T},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":26,"../utils":27,"./sdp/RemoteUnifiedPlanSdp":21,"./sdp/commonUtils":22,"./sdp/unifiedPlanUtils":24,"sdp-transform":36}],16:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=p(e("sdp-transform")),o=p(e("../Logger")),a=p(e("../EnhancedEventEmitter")),i=l(e("../utils")),s=l(e("../ortc")),c=l(e("./sdp/commonUtils")),u=l(e("./sdp/unifiedPlanUtils")),d=p(e("./sdp/RemoteUnifiedPlanSdp"));function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}function p(e){return e&&e.__esModule?e:{default:e}}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t,r){return t&&h(e.prototype,t),r&&h(e,r),e}function y(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var P=new o.default("Firefox59"),w=function(e){function t(e,r,n){var o;return m(this,t),(o=y(this,_(t).call(this,P)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new d.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return g(t,a.default),v(t,[{key:"close",value:function(){P.debug("close()");try{this._pc.close()}catch(e){}}}]),t}(),k=function(e){function t(e,r){var n;return m(this,t),(n=y(this,_(t).call(this,"send",e,r)))._transportReady=!1,n._stream=new MediaStream,n._nextRid=1,n}return g(t,w),v(t,[{key:"addProducer",value:function(e){var t,r,o=this,a=e.track;return P.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,a.id),this._stream.getTrackById(a.id)?Promise.reject(new Error("track already added")):Promise.resolve().then(function(){o._stream.addTrack(a),t=o._pc.addTrack(a,o._stream)}).then(function(){if(e.simulcast){P.debug("addProducer() | enabling simulcast");var r=[];return e.simulcast.high&&r.push({rid:"high".concat(o._nextRid),active:!0,priority:"low",maxBitrate:e.simulcast.high}),e.simulcast.medium&&r.push({rid:"medium".concat(o._nextRid),active:!0,priority:"medium",maxBitrate:e.simulcast.medium}),e.simulcast.low&&r.push({rid:"low".concat(o._nextRid),active:!0,priority:"high",maxBitrate:e.simulcast.low}),o._nextRid++,t.setParameters({encodings:r})}}).then(function(){return o._pc.createOffer()}).then(function(e){return P.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",e),o._pc.setLocalDescription(e)}).then(function(){if(!o._transportReady)return o._setupTransport()}).then(function(){r=n.default.parse(o._pc.localDescription.sdp);var e={type:"answer",sdp:o._remoteSdp.createAnswerSdp(r)};return P.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),o._pc.setRemoteDescription(e)}).then(function(){var t=i.clone(o._rtpParametersByKind[e.kind]);return u.fillRtpParametersForTrack(t,r,a),t}).catch(function(e){try{o._pc.removeTrack(t)}catch(e){}throw o._stream.removeTrack(a),e})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return P.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){var e=t._pc.getSenders().find(function(e){return e.track===r});if(!e)throw new Error("RTCRtpSender found");return t._pc.removeTrack(e),t._stream.removeTrack(r),Promise.resolve().then(function(){return t._pc.createOffer()}).then(function(e){return P.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})}).then(function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;P.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===n});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){r._stream.removeTrack(n),r._stream.addTrack(t)})}},{key:"restartIce",value:function(e){var t=this;return P.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return P.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})}},{key:"_setupTransport",value:function(){var e=this;return P.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,o=n.default.parse(r),a=c.extractDtlsParameters(o);return a.role="server",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(),S=function(e){function t(e,r){var n;return m(this,t),(n=y(this,_(t).call(this,"recv",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new Map,n}return g(t,w),v(t,[{key:"addConsumer",value:function(e){var t=this;if(P.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={mid:"".concat(e.kind[0]).concat(e.id),kind:e.kind,closed:e.closed,streamId:"recv-stream-".concat(e.id),trackId:"consumer-".concat(e.kind,"-").concat(e.id),ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return P.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getTransceivers().find(function(e){var t=e.receiver;return!!t&&(!!t.track&&e.mid===o.mid)});if(!e)throw new Error("remote track not found");return e.receiver.track})}},{key:"removeConsumer",value:function(e){var t=this;P.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return P.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return P.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return P.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return P.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){P.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=n.default.parse(e),r={dtlsParameters:c.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(),T=function(){function e(t,r,n){var o;switch(m(this,e),P.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r),t){case"send":return o={audio:s.getSendingRtpParameters("audio",r),video:s.getSendingRtpParameters("video",r)},new k(o,n);case"recv":return o={audio:s.getReceivingFullRtpParameters("audio",r),video:s.getReceivingFullRtpParameters("video",r)},new S(o,n)}}return v(e,null,[{key:"getNativeRtpCapabilities",value:function(){P.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");var r=t.captureStream(),o=r.getVideoTracks()[0];return e.addTrack(o,r).setParameters({encodings:[{rid:"RID1",maxBitrate:4e4},{rid:"RID2",maxBitrate:1e4}]}),e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(r){try{t.remove()}catch(e){}try{o.stop()}catch(e){}try{e.close()}catch(e){}var a=n.default.parse(r.sdp);return c.extractRtpCapabilities(a)}).catch(function(r){try{t.remove()}catch(e){}try{o.stop()}catch(e){}try{e.close()}catch(e){}throw r})}},{key:"tag",get:function(){return"Firefox59"}}]),e}();r.default=T},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":26,"../utils":27,"./sdp/RemoteUnifiedPlanSdp":21,"./sdp/commonUtils":22,"./sdp/unifiedPlanUtils":24,"sdp-transform":36}],17:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=p(e("sdp-transform")),o=p(e("../Logger")),a=p(e("../EnhancedEventEmitter")),i=l(e("../utils")),s=l(e("../ortc")),c=l(e("./sdp/commonUtils")),u=l(e("./sdp/planBUtils")),d=p(e("./sdp/RemotePlanBSdp"));function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}function p(e){return e&&e.__esModule?e:{default:e}}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t,r){return t&&h(e.prototype,t),r&&h(e,r),e}function y(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var P=new o.default("ReactNative"),w=function(e){function t(e,r,n){var o;return m(this,t),(o=y(this,_(t).call(this,P)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new d.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return g(t,a.default),v(t,[{key:"close",value:function(){P.debug("close()");try{this._pc.close()}catch(e){}}}]),t}(),k=function(e){function t(e,r){var n;return m(this,t),(n=y(this,_(t).call(this,"send",e,r)))._transportReady=!1,n._tracks=new Set,n}return g(t,w),v(t,[{key:"addProducer",value:function(e){var t,r,o=this,a=e.track;return P.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,a.id),this._tracks.has(a)?Promise.reject(new Error("track already added")):a.streamReactTag?Promise.resolve().then(function(){return o._tracks.add(a),(t=new MediaStream(a.streamReactTag)).addTrack(a),o._pc.addStream(t),o._pc.createOffer()}).then(function(t){if(e.simulcast){P.debug("addProducer() | enabling simulcast");var r=n.default.parse(t.sdp);u.addSimulcastForTrack(r,a),t={type:"offer",sdp:n.default.write(r)}}P.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",t);var i=new RTCSessionDescription(t);return o._pc.setLocalDescription(i)}).then(function(){if(!o._transportReady)return o._setupTransport()}).then(function(){r=n.default.parse(o._pc.localDescription.sdp);var e={type:"answer",sdp:o._remoteSdp.createAnswerSdp(r)};P.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e);var t=new RTCSessionDescription(e);return o._pc.setRemoteDescription(t)}).then(function(){var t=i.clone(o._rtpParametersByKind[e.kind]);return u.fillRtpParametersForTrack(t,r,a),t}).catch(function(e){throw o._tracks.delete(a),t.removeTrack(a),o._pc.addStream(t),e}):Promise.reject(new Error("no track.streamReactTag property"))}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return P.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),r.streamReactTag?Promise.resolve().then(function(){t._tracks.delete(r);var e=new MediaStream(r.streamReactTag);return e.addTrack(r),t._pc.addStream(e),t._pc.createOffer()}).then(function(e){return P.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).catch(function(e){if(0!==t._tracks.size)throw e;P.warn("removeProducer() | ignoring expected error due no sending tracks: %s",e.toString())}).then(function(){if("stable"!==t._pc.signalingState){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};P.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r);var o=new RTCSessionDescription(r);return t._pc.setRemoteDescription(o)}}):Promise.reject(new Error("no track.streamReactTag property"))}},{key:"replaceProducerTrack",value:function(e,t){var r=this;if(P.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id),!t.streamReactTag)return Promise.reject(new Error("no track.streamReactTag property"));var o,a,s=e.track;return Promise.resolve().then(function(){return r._tracks.add(t),r._tracks.delete(s),(o=new MediaStream(t.streamReactTag)).addTrack(t),o.removeTrack(s),r._pc.addStream(o),r._pc.createOffer()}).then(function(o){if(e.simulcast){P.debug("addProducer() | enabling simulcast");var a=n.default.parse(o.sdp);u.addSimulcastForTrack(a,t),o={type:"offer",sdp:n.default.write(a)}}P.debug("replaceProducerTrack() | calling pc.setLocalDescription() [offer:%o]",o);var i=new RTCSessionDescription(o);return r._pc.setLocalDescription(i)}).then(function(){a=n.default.parse(r._pc.localDescription.sdp);var e={type:"answer",sdp:r._remoteSdp.createAnswerSdp(a)};P.debug("replaceProducerTrack() | calling pc.setRemoteDescription() [answer:%o]",e);var t=new RTCSessionDescription(e);return r._pc.setRemoteDescription(t)}).then(function(){var n=i.clone(r._rtpParametersByKind[e.kind]);u.fillRtpParametersForTrack(n,a,t),r.safeEmit("@needupdateproducer",e,n)}).catch(function(e){throw r._tracks.delete(t),o.removeTrack(t),r._pc.addStream(o),e})}},{key:"restartIce",value:function(e){var t=this;return P.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return P.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};P.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r);var o=new RTCSessionDescription(r);return t._pc.setRemoteDescription(o)})}},{key:"_setupTransport",value:function(){var e=this;return P.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,o=n.default.parse(r),a=c.extractDtlsParameters(o);return a.role="server",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(),S=function(e){function t(e,r){var n;return m(this,t),(n=y(this,_(t).call(this,"recv",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._kinds=new Set,n._consumerInfos=new Map,n}return g(t,w),v(t,[{key:"addConsumer",value:function(e){var t=this;if(P.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:"recv-stream-".concat(e.id),trackId:"consumer-".concat(e.kind,"-").concat(e.id),ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};P.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e);var r=new RTCSessionDescription(e);return t._pc.setRemoteDescription(r)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getRemoteStreams().find(function(e){return e.id===o.streamId}),r=e.getTrackById(o.trackId);if(r.streamReactTag=e.reactTag,!r)throw new Error("remote track not found");return r})}},{key:"removeConsumer",value:function(e){var t=this;return P.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};P.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e);var r=new RTCSessionDescription(e);return t._pc.setRemoteDescription(r)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return P.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};P.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e);var r=new RTCSessionDescription(e);return t._pc.setRemoteDescription(r)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return P.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){P.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=n.default.parse(e),r={dtlsParameters:c.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(),T=function(){function e(t,r,n){var o;switch(m(this,e),P.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r),t){case"send":return o={audio:s.getSendingRtpParameters("audio",r),video:s.getSendingRtpParameters("video",r)},new k(o,n);case"recv":return o={audio:s.getReceivingFullRtpParameters("audio",r),video:s.getReceivingFullRtpParameters("video",r)},new S(o,n)}}return v(e,null,[{key:"getNativeRtpCapabilities",value:function(){P.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(t){try{e.close()}catch(e){}var r=n.default.parse(t.sdp);return c.extractRtpCapabilities(r)}).catch(function(t){try{e.close()}catch(e){}throw t})}},{key:"tag",get:function(){return"ReactNative"}}]),e}();r.default=T},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":26,"../utils":27,"./sdp/RemotePlanBSdp":20,"./sdp/commonUtils":22,"./sdp/planBUtils":23,"sdp-transform":36}],18:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=p(e("sdp-transform")),o=p(e("../Logger")),a=p(e("../EnhancedEventEmitter")),i=l(e("../utils")),s=l(e("../ortc")),c=l(e("./sdp/commonUtils")),u=l(e("./sdp/planBUtils")),d=p(e("./sdp/RemotePlanBSdp"));function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}function p(e){return e&&e.__esModule?e:{default:e}}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t,r){return t&&h(e.prototype,t),r&&h(e,r),e}function y(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var P=new o.default("Safari11"),w=function(e){function t(e,r,n){var o;return m(this,t),(o=y(this,_(t).call(this,P)))._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:n.iceTransportPolicy,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new d.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return g(t,a.default),v(t,[{key:"close",value:function(){P.debug("close()");try{this._pc.close()}catch(e){}}}]),t}(),k=function(e){function t(e,r){var n;return m(this,t),(n=y(this,_(t).call(this,"send",e,r)))._transportReady=!1,n._stream=new MediaStream,n}return g(t,w),v(t,[{key:"addProducer",value:function(e){var t,r,o=this,a=e.track;return P.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,a.id),this._stream.getTrackById(a.id)?Promise.reject(new Error("track already added")):Promise.resolve().then(function(){return o._stream.addTrack(a),t=o._pc.addTrack(a,o._stream),o._pc.createOffer()}).then(function(e){return P.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",e),o._pc.setLocalDescription(e)}).then(function(){if(!o._transportReady)return o._setupTransport()}).then(function(){r=n.default.parse(o._pc.localDescription.sdp);var e={type:"answer",sdp:o._remoteSdp.createAnswerSdp(r)};return P.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),o._pc.setRemoteDescription(e)}).then(function(){var t=i.clone(o._rtpParametersByKind[e.kind]);return u.fillRtpParametersForTrack(t,r,a),t}).catch(function(e){try{o._pc.removeTrack(t)}catch(e){}throw o._stream.removeTrack(a),e})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return P.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){var e=t._pc.getSenders().find(function(e){return e.track===r});if(!e)throw new Error("RTCRtpSender found");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()}).then(function(e){return P.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).catch(function(e){if(0!==t._stream.getTracks().length)throw e;P.warn("removeLocalTrack() | ignoring expected error due no sending tracks: %s",e.toString())}).then(function(){if("stable"!==t._pc.signalingState){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;P.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===n});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){r._stream.removeTrack(n),r._stream.addTrack(t)})}},{key:"restartIce",value:function(e){var t=this;return P.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return P.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=n.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return P.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})}},{key:"_setupTransport",value:function(){var e=this;return P.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,o=n.default.parse(r),a=c.extractDtlsParameters(o);return a.role="server",t.dtlsParameters=a,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(),S=function(e){function t(e,r){var n;return m(this,t),(n=y(this,_(t).call(this,"recv",e,r)))._transportCreated=!1,n._transportUpdated=!1,n._kinds=new Set,n._consumerInfos=new Map,n}return g(t,w),v(t,[{key:"addConsumer",value:function(e){var t=this;if(P.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject(new Error("Consumer already added"));var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,streamId:"recv-stream-".concat(e.id),trackId:"consumer-".concat(e.kind,"-").concat(e.id),ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return P.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getReceivers().find(function(e){var t=e.track;return!!t&&t.id===o.trackId});if(!e)throw new Error("remote track not found");return e.track})}},{key:"removeConsumer",value:function(e){var t=this;return P.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return P.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject(new Error("Consumer not found"))}},{key:"restartIce",value:function(e){var t=this;return P.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return P.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return P.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return P.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){P.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=n.default.parse(e),r={dtlsParameters:c.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(),T=function(){function e(t,r,n){var o;switch(m(this,e),P.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r),t){case"send":return o={audio:s.getSendingRtpParameters("audio",r),video:s.getSendingRtpParameters("video",r)},new k(o,n);case"recv":return o={audio:s.getReceivingFullRtpParameters("audio",r),video:s.getReceivingFullRtpParameters("video",r)},new S(o,n)}}return v(e,null,[{key:"getNativeRtpCapabilities",value:function(){P.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return e.addTransceiver("audio"),e.addTransceiver("video"),e.createOffer().then(function(t){try{e.close()}catch(e){}var r=n.default.parse(t.sdp);return c.extractRtpCapabilities(r)}).catch(function(t){try{e.close()}catch(e){}throw t})}},{key:"tag",get:function(){return"Safari11"}}]),e}();r.default=T},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":26,"../utils":27,"./sdp/RemotePlanBSdp":20,"./sdp/commonUtils":22,"./sdp/planBUtils":23,"sdp-transform":36}],19:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getCapabilities=function(){var e=RTCRtpReceiver.getCapabilities(),t=n.clone(e),r=!0,o=!1,a=void 0;try{for(var i,s=t.codecs[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var c=i.value;if(c.channels=c.numChannels,delete c.numChannels,"audio"!==c.kind?delete c.channels:c.channels||(c.channels=1),c.mimeType="".concat(c.kind,"/").concat(c.name),c.parameters){var u=c.parameters;u.apt&&(u.apt=Number(u.apt)),u["packetization-mode"]&&(u["packetization-mode"]=Number(u["packetization-mode"]))}var d=!0,l=!1,p=void 0;try{for(var f,m=(c.rtcpFeedback||[])[Symbol.iterator]();!(d=(f=m.next()).done);d=!0){var h=f.value;h.parameter||delete h.parameter}}catch(e){l=!0,p=e}finally{try{d||null==m.return||m.return()}finally{if(l)throw p}}}}catch(e){o=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw a}}return t},r.mangleRtpParameters=function(e){var t=n.clone(e),r=!0,o=!1,a=void 0;try{for(var i,s=t.codecs[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var c=i.value;c.channels&&(c.numChannels=c.channels,delete c.channels),delete c.mimeType}}catch(e){o=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw a}}return t};var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(e("../../utils"))},{"../../utils":27}],20:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=i(e("sdp-transform")),o=i(e("../../Logger")),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(e("../../utils"));function i(e){return e&&e.__esModule?e:{default:e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t,r){return t&&f(e.prototype,t),r&&f(e,r),e}var h=new o.default("RemotePlanBSdp"),v=function(){function e(t){p(this,e),this._rtpParametersByKind=t,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:a.randomNumber(),version:0}}return m(e,[{key:"setTransportLocalParameters",value:function(e){h.debug("setTransportLocalParameters() [transportLocalParameters:%o]",e),this._transportLocalParameters=e}},{key:"setTransportRemoteParameters",value:function(e){h.debug("setTransportRemoteParameters() [transportRemoteParameters:%o]",e),this._transportRemoteParameters=e}},{key:"updateTransportRemoteIceParameters",value:function(e){h.debug("updateTransportRemoteIceParameters() [remoteIceParameters:%o]",e),this._transportRemoteParameters.iceParameters=e}}]),e}(),y=function(e){function t(e){return p(this,t),c(this,u(t).call(this,e))}return d(t,v),m(t,[{key:"createAnswerSdp",value:function(e){if(h.debug("createAnswerSdp()"),!this._transportLocalParameters)throw new Error("no transport local parameters");if(!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,o=this._transportRemoteParameters.dtlsParameters,a={},i=(e.media||[]).map(function(e){return String(e.mid)});this._sdpGlobalFields.version++,a.version=0,a.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},a.name="-",a.timing={start:0,stop:0},a.icelite=t.iceLite?"ice-lite":null,a.msidSemantic={semantic:"WMS",token:"*"},a.groups=[{type:"BUNDLE",mids:i.join(" ")}],a.media=[];var s=o.fingerprints.length;a.fingerprint={type:o.fingerprints[s-1].algorithm,hash:o.fingerprints[s-1].value};var c=!0,u=!1,d=void 0;try{for(var l,p=(e.media||[])[Symbol.iterator]();!(c=(l=p.next()).done);c=!0){var f=l.value,m=f.type,v=this._rtpParametersByKind[m].codecs,y=this._rtpParametersByKind[m].headerExtensions,_={};_.type=f.type,_.port=7,_.protocol="RTP/SAVPF",_.connection={ip:"127.0.0.1",version:4},_.mid=f.mid,_.iceUfrag=t.usernameFragment,_.icePwd=t.password,_.candidates=[];var g=!0,b=!1,P=void 0;try{for(var w,k=r[Symbol.iterator]();!(g=(w=k.next()).done);g=!0){var S=w.value,T={component:1};T.foundation=S.foundation,T.ip=S.ip,T.port=S.port,T.priority=S.priority,T.transport=S.protocol,T.type=S.type,S.tcpType&&(T.tcptype=S.tcpType),_.candidates.push(T)}}catch(e){b=!0,P=e}finally{try{g||null==k.return||k.return()}finally{if(b)throw P}}switch(_.endOfCandidates="end-of-candidates",_.iceOptions="renomination",o.role){case"client":_.setup="active";break;case"server":_.setup="passive"}switch(f.direction){case"sendrecv":case"sendonly":_.direction="recvonly";break;case"recvonly":case"inactive":_.direction="inactive"}"video"===m&&(_.xGoogleFlag="conference"),_.rtp=[],_.rtcpFb=[],_.fmtp=[];var R=!0,C=!1,E=void 0;try{for(var O,x=v[Symbol.iterator]();!(R=(O=x.next()).done);R=!0){var j=O.value,D={payload:j.payloadType,codec:j.name,rate:j.clockRate};if(j.channels>1&&(D.encoding=j.channels),_.rtp.push(D),j.parameters){for(var I={payload:j.payloadType,config:""},L=Object.keys(j.parameters),F=0;F<L.length;F++){var A=L[F];I.config&&(I.config+=";"),I.config+="".concat(A,"=").concat(j.parameters[A])}I.config&&_.fmtp.push(I)}if(j.rtcpFeedback){var M=!0,B=!1,N=void 0;try{for(var U,q=j.rtcpFeedback[Symbol.iterator]();!(M=(U=q.next()).done);M=!0){var z=U.value;_.rtcpFb.push({payload:j.payloadType,type:z.type,subtype:z.parameter||""})}}catch(e){B=!0,N=e}finally{try{M||null==q.return||q.return()}finally{if(B)throw N}}}}}catch(e){C=!0,E=e}finally{try{R||null==x.return||x.return()}finally{if(C)throw E}}_.payloads=v.map(function(e){return e.payloadType}).join(" "),_.ext=[];var G=!0,K=!1,V=void 0;try{for(var W,Q=function(){var e=W.value;if(!(f.ext||[]).find(function(t){return t.uri===e.uri}))return"continue";_.ext.push({uri:e.uri,value:e.id})},$=y[Symbol.iterator]();!(G=(W=$.next()).done);G=!0)Q()}catch(e){K=!0,V=e}finally{try{G||null==$.return||$.return()}finally{if(K)throw V}}_.rtcpMux="rtcp-mux",_.rtcpRsize="rtcp-rsize",a.media.push(_)}}catch(e){u=!0,d=e}finally{try{c||null==p.return||p.return()}finally{if(u)throw d}}return n.default.write(a)}}]),t}(),_=function(e){function t(e){return p(this,t),c(this,u(t).call(this,e))}return d(t,v),m(t,[{key:"createOfferSdp",value:function(e,t){var r=this;if(h.debug("createOfferSdp()"),!this._transportRemoteParameters)throw new Error("no transport remote parameters");var o=this._transportRemoteParameters.iceParameters,a=this._transportRemoteParameters.iceCandidates,i=this._transportRemoteParameters.dtlsParameters,s={},c=e;this._sdpGlobalFields.version++,s.version=0,s.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},s.name="-",s.timing={start:0,stop:0},s.icelite=o.iceLite?"ice-lite":null,s.msidSemantic={semantic:"WMS",token:"*"},s.groups=[{type:"BUNDLE",mids:c.join(" ")}],s.media=[];var u=i.fingerprints.length;s.fingerprint={type:i.fingerprints[u-1].algorithm,hash:i.fingerprints[u-1].value};var d=!0,l=!1,p=void 0;try{for(var f,m=function(){var e=f.value,n=r._rtpParametersByKind[e].codecs,i=r._rtpParametersByKind[e].headerExtensions,c={};c.type=e,c.port=7,c.protocol="RTP/SAVPF",c.connection={ip:"127.0.0.1",version:4},c.mid=e,c.iceUfrag=o.usernameFragment,c.icePwd=o.password,c.candidates=[];var u=!0,d=!1,l=void 0;try{for(var p,m=a[Symbol.iterator]();!(u=(p=m.next()).done);u=!0){var h=p.value,v={component:1};v.foundation=h.foundation,v.ip=h.ip,v.port=h.port,v.priority=h.priority,v.transport=h.protocol,v.type=h.type,h.tcpType&&(v.tcptype=h.tcpType),c.candidates.push(v)}}catch(e){d=!0,l=e}finally{try{u||null==m.return||m.return()}finally{if(d)throw l}}c.endOfCandidates="end-of-candidates",c.iceOptions="renomination",c.setup="actpass",t.some(function(t){return t.kind===e})?c.direction="sendonly":c.direction="inactive",c.rtp=[],c.rtcpFb=[],c.fmtp=[];var y=!0,_=!1,g=void 0;try{for(var b,P=n[Symbol.iterator]();!(y=(b=P.next()).done);y=!0){var w=b.value,k={payload:w.payloadType,codec:w.name,rate:w.clockRate};if(w.channels>1&&(k.encoding=w.channels),c.rtp.push(k),w.parameters){for(var S={payload:w.payloadType,config:""},T=Object.keys(w.parameters),R=0;R<T.length;R++){var C=T[R];S.config&&(S.config+=";"),S.config+="".concat(C,"=").concat(w.parameters[C])}S.config&&c.fmtp.push(S)}if(w.rtcpFeedback){var E=!0,O=!1,x=void 0;try{for(var j,D=w.rtcpFeedback[Symbol.iterator]();!(E=(j=D.next()).done);E=!0){var I=j.value;c.rtcpFb.push({payload:w.payloadType,type:I.type,subtype:I.parameter||""})}}catch(e){O=!0,x=e}finally{try{E||null==D.return||D.return()}finally{if(O)throw x}}}}}catch(e){_=!0,g=e}finally{try{y||null==P.return||P.return()}finally{if(_)throw g}}c.payloads=n.map(function(e){return e.payloadType}).join(" "),c.ext=[];var L=!0,F=!1,A=void 0;try{for(var M,B=i[Symbol.iterator]();!(L=(M=B.next()).done);L=!0){var N=M.value;c.ext.push({uri:N.uri,value:N.id})}}catch(e){F=!0,A=e}finally{try{L||null==B.return||B.return()}finally{if(F)throw A}}c.rtcpMux="rtcp-mux",c.rtcpRsize="rtcp-rsize",c.ssrcs=[],c.ssrcGroups=[];var U=!0,q=!1,z=void 0;try{for(var G,K=t[Symbol.iterator]();!(U=(G=K.next()).done);U=!0){var V=G.value;V.kind===e&&(c.ssrcs.push({id:V.ssrc,attribute:"msid",value:"".concat(V.streamId," ").concat(V.trackId)}),c.ssrcs.push({id:V.ssrc,attribute:"mslabel",value:V.streamId}),c.ssrcs.push({id:V.ssrc,attribute:"label",value:V.trackId}),c.ssrcs.push({id:V.ssrc,attribute:"cname",value:V.cname}),V.rtxSsrc&&(c.ssrcs.push({id:V.rtxSsrc,attribute:"msid",value:"".concat(V.streamId," ").concat(V.trackId)}),c.ssrcs.push({id:V.rtxSsrc,attribute:"mslabel",value:V.streamId}),c.ssrcs.push({id:V.rtxSsrc,attribute:"label",value:V.trackId}),c.ssrcs.push({id:V.rtxSsrc,attribute:"cname",value:V.cname}),c.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(V.ssrc," ").concat(V.rtxSsrc)})))}}catch(e){q=!0,z=e}finally{try{U||null==K.return||K.return()}finally{if(q)throw z}}s.media.push(c)},v=e[Symbol.iterator]();!(d=(f=v.next()).done);d=!0)m()}catch(e){l=!0,p=e}finally{try{d||null==v.return||v.return()}finally{if(l)throw p}}return n.default.write(s)}}]),t}();r.default=function e(t,r){switch(p(this,e),h.debug("constructor() [direction:%s, rtpParametersByKind:%o]",t,r),t){case"send":return new y(r);case"recv":return new _(r)}}},{"../../Logger":5,"../../utils":27,"sdp-transform":36}],21:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=i(e("sdp-transform")),o=i(e("../../Logger")),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(e("../../utils"));function i(e){return e&&e.__esModule?e:{default:e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t,r){return t&&f(e.prototype,t),r&&f(e,r),e}var h=new o.default("RemoteUnifiedPlanSdp"),v=function(){function e(t){p(this,e),this._rtpParametersByKind=t,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:a.randomNumber(),version:0}}return m(e,[{key:"setTransportLocalParameters",value:function(e){h.debug("setTransportLocalParameters() [transportLocalParameters:%o]",e),this._transportLocalParameters=e}},{key:"setTransportRemoteParameters",value:function(e){h.debug("setTransportRemoteParameters() [transportRemoteParameters:%o]",e),this._transportRemoteParameters=e}},{key:"updateTransportRemoteIceParameters",value:function(e){h.debug("updateTransportRemoteIceParameters() [remoteIceParameters:%o]",e),this._transportRemoteParameters.iceParameters=e}}]),e}(),y=function(e){function t(e){return p(this,t),c(this,u(t).call(this,e))}return d(t,v),m(t,[{key:"createAnswerSdp",value:function(e){if(h.debug("createAnswerSdp()"),!this._transportLocalParameters)throw new Error("no transport local parameters");if(!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,o=this._transportRemoteParameters.dtlsParameters,a={},i=(e.media||[]).filter(function(e){return e.hasOwnProperty("mid")}).map(function(e){return String(e.mid)});this._sdpGlobalFields.version++,a.version=0,a.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},a.name="-",a.timing={start:0,stop:0},a.icelite=t.iceLite?"ice-lite":null,a.msidSemantic={semantic:"WMS",token:"*"},i.length>0&&(a.groups=[{type:"BUNDLE",mids:i.join(" ")}]),a.media=[];var s=o.fingerprints.length;a.fingerprint={type:o.fingerprints[s-1].algorithm,hash:o.fingerprints[s-1].value};var c=!0,u=!1,d=void 0;try{for(var l,p=(e.media||[])[Symbol.iterator]();!(c=(l=p.next()).done);c=!0){var f=l.value,m="inactive"===f.direction,v=f.type,y=this._rtpParametersByKind[v].codecs,_=this._rtpParametersByKind[v].headerExtensions,g={};g.type=f.type,g.port=7,g.protocol="RTP/SAVPF",g.connection={ip:"127.0.0.1",version:4},g.mid=f.mid,g.iceUfrag=t.usernameFragment,g.icePwd=t.password,g.candidates=[];var b=!0,P=!1,w=void 0;try{for(var k,S=r[Symbol.iterator]();!(b=(k=S.next()).done);b=!0){var T=k.value,R={component:1};R.foundation=T.foundation,R.ip=T.ip,R.port=T.port,R.priority=T.priority,R.transport=T.protocol,R.type=T.type,T.tcpType&&(R.tcptype=T.tcpType),g.candidates.push(R)}}catch(e){P=!0,w=e}finally{try{b||null==S.return||S.return()}finally{if(P)throw w}}switch(g.endOfCandidates="end-of-candidates",g.iceOptions="renomination",o.role){case"client":g.setup="active";break;case"server":g.setup="passive"}switch(f.direction){case"sendrecv":case"sendonly":g.direction="recvonly";break;case"recvonly":case"inactive":g.direction="inactive"}g.rtp=[],g.rtcpFb=[],g.fmtp=[];var C=!0,E=!1,O=void 0;try{for(var x,j=y[Symbol.iterator]();!(C=(x=j.next()).done);C=!0){var D=x.value,I={payload:D.payloadType,codec:D.name,rate:D.clockRate};if(D.channels>1&&(I.encoding=D.channels),g.rtp.push(I),D.parameters){for(var L={payload:D.payloadType,config:""},F=Object.keys(D.parameters),A=0;A<F.length;A++){var M=F[A];L.config&&(L.config+=";"),L.config+="".concat(M,"=").concat(D.parameters[M])}L.config&&g.fmtp.push(L)}if(D.rtcpFeedback){var B=!0,N=!1,U=void 0;try{for(var q,z=D.rtcpFeedback[Symbol.iterator]();!(B=(q=z.next()).done);B=!0){var G=q.value;g.rtcpFb.push({payload:D.payloadType,type:G.type,subtype:G.parameter||""})}}catch(e){N=!0,U=e}finally{try{B||null==z.return||z.return()}finally{if(N)throw U}}}}}catch(e){E=!0,O=e}finally{try{C||null==j.return||j.return()}finally{if(E)throw O}}if(g.payloads=y.map(function(e){return e.payloadType}).join(" "),!m){g.ext=[];var K=!0,V=!1,W=void 0;try{for(var Q,$=function(){var e=Q.value;if(!(f.ext||[]).find(function(t){return t.uri===e.uri}))return"continue";g.ext.push({uri:e.uri,value:e.id})},J=_[Symbol.iterator]();!(K=(Q=J.next()).done);K=!0)$()}catch(e){V=!0,W=e}finally{try{K||null==J.return||J.return()}finally{if(V)throw W}}}if(f.simulcast_03){g.simulcast_03={value:f.simulcast_03.value.replace(/send/g,"recv")},g.rids=[];var H=!0,X=!1,Z=void 0;try{for(var Y,ee=(f.rids||[])[Symbol.iterator]();!(H=(Y=ee.next()).done);H=!0){var te=Y.value;"send"===te.direction&&g.rids.push({id:te.id,direction:"recv"})}}catch(e){X=!0,Z=e}finally{try{H||null==ee.return||ee.return()}finally{if(X)throw Z}}}g.rtcpMux="rtcp-mux",g.rtcpRsize="rtcp-rsize",a.media.push(g)}}catch(e){u=!0,d=e}finally{try{c||null==p.return||p.return()}finally{if(u)throw d}}return n.default.write(a)}}]),t}(),_=function(e){function t(e){return p(this,t),c(this,u(t).call(this,e))}return d(t,v),m(t,[{key:"createOfferSdp",value:function(e){if(h.debug("createOfferSdp()"),!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,o=this._transportRemoteParameters.dtlsParameters,a={},i=e.map(function(e){return String(e.mid)});this._sdpGlobalFields.version++,a.version=0,a.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},a.name="-",a.timing={start:0,stop:0},a.icelite=t.iceLite?"ice-lite":null,a.msidSemantic={semantic:"WMS",token:"*"},i.length>0&&(a.groups=[{type:"BUNDLE",mids:i.join(" ")}]),a.media=[];var s=o.fingerprints.length;a.fingerprint={type:o.fingerprints[s-1].algorithm,hash:o.fingerprints[s-1].value};var c=!0,u=!1,d=void 0;try{for(var l,p=e[Symbol.iterator]();!(c=(l=p.next()).done);c=!0){var f=l.value,m=f.closed,v=f.kind,y=void 0,_=void 0;"application"!==f.kind&&(y=this._rtpParametersByKind[v].codecs,_=this._rtpParametersByKind[v].headerExtensions);var g={};"application"!==f.kind?(g.type=v,g.port=7,g.protocol="RTP/SAVPF",g.connection={ip:"127.0.0.1",version:4},g.mid=f.mid,g.msid="".concat(f.streamId," ").concat(f.trackId)):(g.type=v,g.port=9,g.protocol="DTLS/SCTP",g.connection={ip:"127.0.0.1",version:4},g.mid=f.mid),g.iceUfrag=t.usernameFragment,g.icePwd=t.password,g.candidates=[];var b=!0,P=!1,w=void 0;try{for(var k,S=r[Symbol.iterator]();!(b=(k=S.next()).done);b=!0){var T=k.value,R={component:1};R.foundation=T.foundation,R.ip=T.ip,R.port=T.port,R.priority=T.priority,R.transport=T.protocol,R.type=T.type,T.tcpType&&(R.tcptype=T.tcpType),g.candidates.push(R)}}catch(e){P=!0,w=e}finally{try{b||null==S.return||S.return()}finally{if(P)throw w}}if(g.endOfCandidates="end-of-candidates",g.iceOptions="renomination",g.setup="actpass","application"!==f.kind){g.direction=m?"inactive":"sendonly",g.rtp=[],g.rtcpFb=[],g.fmtp=[];var C=!0,E=!1,O=void 0;try{for(var x,j=y[Symbol.iterator]();!(C=(x=j.next()).done);C=!0){var D=x.value,I={payload:D.payloadType,codec:D.name,rate:D.clockRate};if(D.channels>1&&(I.encoding=D.channels),g.rtp.push(I),D.parameters){for(var L={payload:D.payloadType,config:""},F=Object.keys(D.parameters),A=0;A<F.length;A++){var M=F[A];L.config&&(L.config+=";"),L.config+="".concat(M,"=").concat(D.parameters[M])}L.config&&g.fmtp.push(L)}if(D.rtcpFeedback){var B=!0,N=!1,U=void 0;try{for(var q,z=D.rtcpFeedback[Symbol.iterator]();!(B=(q=z.next()).done);B=!0){var G=q.value;g.rtcpFb.push({payload:D.payloadType,type:G.type,subtype:G.parameter||""})}}catch(e){N=!0,U=e}finally{try{B||null==z.return||z.return()}finally{if(N)throw U}}}}}catch(e){E=!0,O=e}finally{try{C||null==j.return||j.return()}finally{if(E)throw O}}if(g.payloads=y.map(function(e){return e.payloadType}).join(" "),!m){g.ext=[];var K=!0,V=!1,W=void 0;try{for(var Q,$=_[Symbol.iterator]();!(K=(Q=$.next()).done);K=!0){var J=Q.value;g.ext.push({uri:J.uri,value:J.id})}}catch(e){V=!0,W=e}finally{try{K||null==$.return||$.return()}finally{if(V)throw W}}}g.rtcpMux="rtcp-mux",g.rtcpRsize="rtcp-rsize",m||(g.ssrcs=[],g.ssrcGroups=[],g.ssrcs.push({id:f.ssrc,attribute:"cname",value:f.cname}),f.rtxSsrc&&(g.ssrcs.push({id:f.rtxSsrc,attribute:"cname",value:f.cname}),g.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(f.ssrc," ").concat(f.rtxSsrc)})))}else g.payloads=5e3,g.sctpmap={app:"webrtc-datachannel",maxMessageSize:256,sctpmapNumber:5e3};a.media.push(g)}}catch(e){u=!0,d=e}finally{try{c||null==p.return||p.return()}finally{if(u)throw d}}return n.default.write(a)}}]),t}();r.default=function e(t,r){switch(p(this,e),h.debug("constructor() [direction:%s, rtpParametersByKind:%o]",t,r),t){case"send":return new y(r);case"recv":return new _(r)}}},{"../../Logger":5,"../../utils":27,"sdp-transform":36}],22:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.extractRtpCapabilities=function(e){var t=new Map,r=[],n=!1,a=!1,i=!0,s=!1,c=void 0;try{for(var u,d=e.media[Symbol.iterator]();!(i=(u=d.next()).done);i=!0){var l=u.value,p=l.type;switch(p){case"audio":if(n)continue;n=!0;break;case"video":if(a)continue;a=!0;break;default:continue}var f=!0,m=!1,h=void 0;try{for(var v,y=l.rtp[Symbol.iterator]();!(f=(v=y.next()).done);f=!0){var _=v.value,g={name:_.codec,mimeType:"".concat(p,"/").concat(_.codec),kind:p,clockRate:_.rate,preferredPayloadType:_.payload,channels:_.encoding,rtcpFeedback:[],parameters:{}};"audio"!==g.kind?delete g.channels:g.channels||(g.channels=1),t.set(g.preferredPayloadType,g)}}catch(e){m=!0,h=e}finally{try{f||null==y.return||y.return()}finally{if(m)throw h}}var b=!0,P=!1,w=void 0;try{for(var k,S=(l.fmtp||[])[Symbol.iterator]();!(b=(k=S.next()).done);b=!0){var T=k.value,R=o.default.parseFmtpConfig(T.config),C=t.get(T.payload);C&&(C.parameters=R)}}catch(e){P=!0,w=e}finally{try{b||null==S.return||S.return()}finally{if(P)throw w}}var E=!0,O=!1,x=void 0;try{for(var j,D=(l.rtcpFb||[])[Symbol.iterator]();!(E=(j=D.next()).done);E=!0){var I=j.value,L=t.get(I.payload);if(L){var F={type:I.type,parameter:I.subtype};F.parameter||delete F.parameter,L.rtcpFeedback.push(F)}}}catch(e){O=!0,x=e}finally{try{E||null==D.return||D.return()}finally{if(O)throw x}}var A=!0,M=!1,B=void 0;try{for(var N,U=(l.ext||[])[Symbol.iterator]();!(A=(N=U.next()).done);A=!0){var q=N.value,z={kind:p,uri:q.uri,preferredId:q.value};r.push(z)}}catch(e){M=!0,B=e}finally{try{A||null==U.return||U.return()}finally{if(M)throw B}}}}catch(e){s=!0,c=e}finally{try{i||null==d.return||d.return()}finally{if(s)throw c}}return{codecs:Array.from(t.values()),headerExtensions:r,fecMechanisms:[]}},r.extractDtlsParameters=function(e){var t,r=function(e){return(e.media||[]).find(function(e){return e.iceUfrag&&0!==e.port})}(e),n=r.fingerprint||e.fingerprint;switch(r.setup){case"active":t="client";break;case"passive":t="server";break;case"actpass":t="auto"}return{role:t,fingerprints:[{algorithm:n.type,value:n.hash}]}};var n,o=(n=e("sdp-transform"))&&n.__esModule?n:{default:n}},{"sdp-transform":36}],23:[function(e,t,r){"use strict";function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}Object.defineProperty(r,"__esModule",{value:!0}),r.fillRtpParametersForTrack=function(e,t,r){var o,a=r.kind,i={cname:null,reducedSize:!0,mux:!0},s=(t.media||[]).find(function(e){return e.type===a});if(!s)throw new Error("m=".concat(a," section not found"));var c=new Set,u=!0,d=!1,l=void 0;try{for(var p,f=(s.ssrcs||[])[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var m=p.value;if("msid"===m.attribute){var h=m.value.split(" ")[1];if(h===r.id){var v=m.id;c.add(v),o||(o=v)}}}}catch(e){d=!0,l=e}finally{try{u||null==f.return||f.return()}finally{if(d)throw l}}if(0===c.size)throw new Error("a=ssrc line not found for local track [track.id:".concat(r.id,"]"));var y=new Map,_=!0,g=!1,b=void 0;try{for(var P,w=(s.ssrcGroups||[])[Symbol.iterator]();!(_=(P=w.next()).done);_=!0){var k=P.value;if("FID"===k.semantics){var S=k.ssrcs.split(/\s+/),T=n(S,2),R=T[0],C=T[1];R=Number(R),C=Number(C),c.has(R)&&(c.delete(R),c.delete(C),y.set(R,C))}}}catch(e){g=!0,b=e}finally{try{_||null==w.return||w.return()}finally{if(g)throw b}}var E=!0,O=!1,x=void 0;try{for(var j,D=c[Symbol.iterator]();!(E=(j=D.next()).done);E=!0){var I=j.value;y.set(I,null)}}catch(e){O=!0,x=e}finally{try{E||null==D.return||D.return()}finally{if(O)throw x}}var L=s.ssrcs.find(function(e){return"cname"===e.attribute&&e.id===o});L&&(i.cname=L.value);e.rtcp=i,e.encodings=[];var F=y.size>1,A=["low","medium","high"],M=!0,B=!1,N=void 0;try{for(var U,q=y[Symbol.iterator]();!(M=(U=q.next()).done);M=!0){var z=n(U.value,2),G=z[0],C=z[1],K={ssrc:G};C&&(K.rtx={ssrc:C}),F&&(K.profile=A.shift()),e.encodings.push(K)}}catch(e){B=!0,N=e}finally{try{M||null==q.return||q.return()}finally{if(B)throw N}}},r.addSimulcastForTrack=function(e,t){var r,n,o,a=t.kind,i=(e.media||[]).find(function(e){return e.type===a});if(!i)throw new Error("m=".concat(a," section not found"));if(!(i.ssrcs||[]).find(function(e){if("msid"!==e.attribute)return!1;var n=e.value.split(" ")[1];return n===t.id?(r=e.id,o=e.value.split(" ")[0],!0):void 0}))throw new Error("a=ssrc line not found for local track [track.id:".concat(t.id,"]"));(i.ssrcGroups||[]).some(function(e){if("FID"===e.semantics){var t=e.ssrcs.split(/\s+/);return Number(t[0])===r?(n=Number(t[1]),!0):void 0}});var s=i.ssrcs.find(function(e){return"cname"===e.attribute&&e.id===r});if(!s)throw new Error("CNAME line not found for local track [track.id:".concat(t.id,"]"));var c=s.value,u=r+1,d=r+2;if(i.ssrcGroups=i.ssrcGroups||[],i.ssrcGroups.push({semantics:"SIM",ssrcs:"".concat(r," ").concat(u," ").concat(d)}),i.ssrcs.push({id:u,attribute:"cname",value:c}),i.ssrcs.push({id:u,attribute:"msid",value:"".concat(o," ").concat(t.id)}),i.ssrcs.push({id:d,attribute:"cname",value:c}),i.ssrcs.push({id:d,attribute:"msid",value:"".concat(o," ").concat(t.id)}),n){var l=n+1,p=n+2;i.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(u," ").concat(l)}),i.ssrcs.push({id:l,attribute:"cname",value:c}),i.ssrcs.push({id:l,attribute:"msid",value:"".concat(o," ").concat(t.id)}),i.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(d," ").concat(p)}),i.ssrcs.push({id:p,attribute:"cname",value:c}),i.ssrcs.push({id:p,attribute:"msid",value:"".concat(o," ").concat(t.id)})}}},{}],24:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.fillRtpParametersForTrack=function(e,t,r){var n=r.kind,o={cname:null,reducedSize:!0,mux:!0},a=(t.media||[]).find(function(e){if(e.type===n){var t=e.msid;if(t){var o=t.split(" ")[1];return o===r.id||void 0}}});if(!a)throw new Error("m=".concat(n," section not found"));var i,s=(a.ssrcs||[]).find(function(e){return"cname"===e.attribute});s&&(i=s.id,o.cname=s.value);var c=[],u=!0,d=!1,l=void 0;try{for(var p,f=(a.rids||[])[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var m=p.value;"send"===m.direction&&(/^low/.test(m.id)?c.push({rid:m.id,profile:"low"}):/^medium/.test(m.id)&&c.push({rid:m.id,profile:"medium"}),/^high/.test(m.id)&&c.push({rid:m.id,profile:"high"}))}}catch(e){d=!0,l=e}finally{try{u||null==f.return||f.return()}finally{if(d)throw l}}if(e.rtcp=o,e.encodings=[],0===c.length){var h={ssrc:i};e.encodings.push(h)}else for(var v=0;v<c.length;v++){var y=c[v],_={encodingId:y.rid,profile:y.profile};e.encodings.push(_)}}},{}],25:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isDeviceSupported=function(){return o.default.isSupported()},r.getDeviceInfo=function(){return{flag:o.default.getFlag(),name:o.default.getName(),version:o.default.getVersion(),bowser:o.default.getBowser()}},r.checkCapabilitiesForRoom=function(e){return o.default.isSupported()?o.default.Handler.getNativeRtpCapabilities().then(function(t){var r=n.getExtendedRtpCapabilities(t,e);return{audio:n.canSend("audio",r),video:n.canSend("video",r)}}):Promise.reject(new Error("current browser/device not supported"))},Object.defineProperty(r,"Room",{enumerable:!0,get:function(){return a.default}});var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(e("./ortc")),o=i(e("./Device")),a=i(e("./Room"));function i(e){return e&&e.__esModule?e:{default:e}}},{"./Device":3,"./Room":8,"./ortc":26}],26:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getExtendedRtpCapabilities=function(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=!0,o=!1,a=void 0;try{for(var i,s=function(){var t=i.value;if("rtx"===t.name)return"continue";var n=(e.codecs||[]).find(function(e){return function(e,t){var r=e.mimeType.toLowerCase(),n=t.mimeType.toLowerCase();if(r!==n)return!1;if(e.clockRate!==t.clockRate)return!1;if(e.channels!==t.channels)return!1;if("video/h264"===r){var o=(e.parameters||{})["packetization-mode"]||0,a=(t.parameters||{})["packetization-mode"]||0;if(o!==a)return!1}return!0}(e,t)});if(n){var o={name:t.name,mimeType:t.mimeType,kind:t.kind,clockRate:t.clockRate,sendPayloadType:n.preferredPayloadType,sendRtxPayloadType:null,recvPayloadType:t.preferredPayloadType,recvRtxPayloadType:null,channels:t.channels,rtcpFeedback:function(e,t){var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=function(){var e=i.value,n=(t.rtcpFeedback||[]).find(function(t){return t.type===e.type&&t.parameter===e.parameter});n&&r.push(n)},c=(e.rtcpFeedback||[])[Symbol.iterator]();!(n=(i=c.next()).done);n=!0)s()}catch(e){o=!0,a=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw a}}return r}(n,t),parameters:t.parameters};o.channels||delete o.channels,r.codecs.push(o)}},c=(t.codecs||[])[Symbol.iterator]();!(n=(i=c.next()).done);n=!0)s()}catch(e){o=!0,a=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw a}}var u=!0,d=!1,l=void 0;try{for(var p,f=function(){var r=p.value,n=(e.codecs||[]).find(function(e){return"rtx"===e.name&&e.parameters.apt===r.sendPayloadType}),o=(t.codecs||[]).find(function(e){return"rtx"===e.name&&e.parameters.apt===r.recvPayloadType});n&&o&&(r.sendRtxPayloadType=n.preferredPayloadType,r.recvRtxPayloadType=o.preferredPayloadType)},m=(r.codecs||[])[Symbol.iterator]();!(u=(p=m.next()).done);u=!0)f()}catch(e){d=!0,l=e}finally{try{u||null==m.return||m.return()}finally{if(d)throw l}}var h=!0,v=!1,y=void 0;try{for(var _,g=function(){var t=_.value,n=(e.headerExtensions||[]).find(function(e){return n=t,!((r=e).kind&&n.kind&&r.kind!==n.kind||r.uri!==n.uri);var r,n});if(n){var o={kind:t.kind,uri:t.uri,sendId:n.preferredId,recvId:t.preferredId};r.headerExtensions.push(o)}},b=(t.headerExtensions||[])[Symbol.iterator]();!(h=(_=b.next()).done);h=!0)g()}catch(e){v=!0,y=e}finally{try{h||null==b.return||b.return()}finally{if(v)throw y}}return r},r.getRtpCapabilities=function(e){var t={codecs:[],headerExtensions:[],fecMechanisms:[]},r=!0,n=!1,o=void 0;try{for(var a,i=e.codecs[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var s=a.value,c={name:s.name,mimeType:s.mimeType,kind:s.kind,clockRate:s.clockRate,preferredPayloadType:s.recvPayloadType,channels:s.channels,rtcpFeedback:s.rtcpFeedback,parameters:s.parameters};if(c.channels||delete c.channels,t.codecs.push(c),s.recvRtxPayloadType){var u={name:"rtx",mimeType:"".concat(s.kind,"/rtx"),kind:s.kind,clockRate:s.clockRate,preferredPayloadType:s.recvRtxPayloadType,parameters:{apt:s.recvPayloadType}};t.codecs.push(u)}}}catch(e){n=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(n)throw o}}var d=!0,l=!1,p=void 0;try{for(var f,m=e.headerExtensions[Symbol.iterator]();!(d=(f=m.next()).done);d=!0){var h=f.value,v={kind:h.kind,uri:h.uri,preferredId:h.recvId};t.headerExtensions.push(v)}}catch(e){l=!0,p=e}finally{try{d||null==m.return||m.return()}finally{if(l)throw p}}return t.fecMechanisms=e.fecMechanisms,t},r.getUnsupportedCodecs=function(e,t,r){if(!Array.isArray(t))return[];var n=[],o=e.codecs,a=r.codecs,i=!0,s=!1,c=void 0;try{for(var u,d=function(){var e=u.value;if(!a.some(function(t){return t.recvPayloadType===e})){var t=o.find(function(t){return t.preferredPayloadType===e});if(!t)throw new Error("mandatory codec PT ".concat(e," not found in remote codecs"));n.push(t)}},l=t[Symbol.iterator]();!(i=(u=l.next()).done);i=!0)d()}catch(e){s=!0,c=e}finally{try{i||null==l.return||l.return()}finally{if(s)throw c}}return n},r.canSend=function(e,t){return t.codecs.some(function(t){return t.kind===e})},r.canReceive=function(e,t){if(0===e.codecs.length)return!1;var r=e.codecs[0];return t.codecs.some(function(e){return e.recvPayloadType===r.payloadType})},r.getSendingRtpParameters=function(e,t){var r={muxId:null,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},n=!0,o=!1,a=void 0;try{for(var i,s=t.codecs[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var c=i.value;if(c.kind===e){var u={name:c.name,mimeType:c.mimeType,clockRate:c.clockRate,payloadType:c.sendPayloadType,channels:c.channels,rtcpFeedback:c.rtcpFeedback,parameters:c.parameters};if(u.channels||delete u.channels,r.codecs.push(u),c.sendRtxPayloadType){var d={name:"rtx",mimeType:"".concat(c.kind,"/rtx"),clockRate:c.clockRate,payloadType:c.sendRtxPayloadType,parameters:{apt:c.sendPayloadType}};r.codecs.push(d)}break}}}catch(e){o=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}var l=!0,p=!1,f=void 0;try{for(var m,h=t.headerExtensions[Symbol.iterator]();!(l=(m=h.next()).done);l=!0){var v=m.value;if(!v.kind||v.kind===e){var y={uri:v.uri,id:v.sendId};r.headerExtensions.push(y)}}}catch(e){p=!0,f=e}finally{try{l||null==h.return||h.return()}finally{if(p)throw f}}return r},r.getReceivingFullRtpParameters=function(e,t){var r={muxId:null,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},n=!0,o=!1,a=void 0;try{for(var i,s=t.codecs[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var c=i.value;if(c.kind===e){var u={name:c.name,mimeType:c.mimeType,clockRate:c.clockRate,payloadType:c.recvPayloadType,channels:c.channels,rtcpFeedback:c.rtcpFeedback,parameters:c.parameters};if(u.channels||delete u.channels,r.codecs.push(u),c.recvRtxPayloadType){var d={name:"rtx",mimeType:"".concat(c.kind,"/rtx"),clockRate:c.clockRate,payloadType:c.recvRtxPayloadType,parameters:{apt:c.recvPayloadType}};r.codecs.push(d)}}}}catch(e){o=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}var l=!0,p=!1,f=void 0;try{for(var m,h=t.headerExtensions[Symbol.iterator]();!(l=(m=h.next()).done);l=!0){var v=m.value;if(!v.kind||v.kind===e){var y={uri:v.uri,id:v.recvId};r.headerExtensions.push(y)}}}catch(e){p=!0,f=e}finally{try{l||null==h.return||h.return()}finally{if(p)throw f}}return r}},{}],27:[function(e,t,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),r.randomNumber=function(){return o()},r.clone=function(e){return JSON.parse(JSON.stringify(e))};var o=((n=e("random-number"))&&n.__esModule?n:{default:n}).default.generator({min:1e7,max:99999999,integer:!0})},{"random-number":34}],28:[function(e,t,r){var n,o;n=this,o=function(){var e=!0;function t(t){function r(e){var r=t.match(e);return r&&r.length>1&&r[1]||""}function n(e){var r=t.match(e);return r&&r.length>1&&r[2]||""}var o,a=r(/(ipod|iphone|ipad)/i).toLowerCase(),i=!/like android/i.test(t)&&/android/i.test(t),s=/nexus\s*[0-6]\s*/i.test(t),c=!s&&/nexus\s*[0-9]+/i.test(t),u=/CrOS/.test(t),d=/silk/i.test(t),l=/sailfish/i.test(t),p=/tizen/i.test(t),f=/(web|hpw)os/i.test(t),m=/windows phone/i.test(t),h=(/SamsungBrowser/i.test(t),!m&&/windows/i.test(t)),v=!a&&!d&&/macintosh/i.test(t),y=!i&&!l&&!p&&!f&&/linux/i.test(t),_=n(/edg([ea]|ios)\/(\d+(\.\d+)?)/i),g=r(/version\/(\d+(\.\d+)?)/i),b=/tablet/i.test(t)&&!/tablet pc/i.test(t),P=!b&&/[^-]mobi/i.test(t),w=/xbox/i.test(t);/opera/i.test(t)?o={name:"Opera",opera:e,version:g||r(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr\/|opios/i.test(t)?o={name:"Opera",opera:e,version:r(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||g}:/SamsungBrowser/i.test(t)?o={name:"Samsung Internet for Android",samsungBrowser:e,version:g||r(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/coast/i.test(t)?o={name:"Opera Coast",coast:e,version:g||r(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(t)?o={name:"Yandex Browser",yandexbrowser:e,version:g||r(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(t)?o={name:"UC Browser",ucbrowser:e,version:r(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(t)?o={name:"Maxthon",maxthon:e,version:r(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(t)?o={name:"Epiphany",epiphany:e,version:r(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(t)?o={name:"Puffin",puffin:e,version:r(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(t)?o={name:"Sleipnir",sleipnir:e,version:r(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(t)?o={name:"K-Meleon",kMeleon:e,version:r(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:m?(o={name:"Windows Phone",osname:"Windows Phone",windowsphone:e},_?(o.msedge=e,o.version=_):(o.msie=e,o.version=r(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(t)?o={name:"Internet Explorer",msie:e,version:r(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:u?o={name:"Chrome",osname:"Chrome OS",chromeos:e,chromeBook:e,chrome:e,version:r(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/edg([ea]|ios)/i.test(t)?o={name:"Microsoft Edge",msedge:e,version:_}:/vivaldi/i.test(t)?o={name:"Vivaldi",vivaldi:e,version:r(/vivaldi\/(\d+(\.\d+)?)/i)||g}:l?o={name:"Sailfish",osname:"Sailfish OS",sailfish:e,version:r(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(t)?o={name:"SeaMonkey",seamonkey:e,version:r(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(t)?(o={name:"Firefox",firefox:e,version:r(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(t)&&(o.firefoxos=e,o.osname="Firefox OS")):d?o={name:"Amazon Silk",silk:e,version:r(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(t)?o={name:"PhantomJS",phantom:e,version:r(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(t)?o={name:"SlimerJS",slimer:e,version:r(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(t)||/rim\stablet/i.test(t)?o={name:"BlackBerry",osname:"BlackBerry OS",blackberry:e,version:g||r(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:f?(o={name:"WebOS",osname:"WebOS",webos:e,version:g||r(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(t)&&(o.touchpad=e)):/bada/i.test(t)?o={name:"Bada",osname:"Bada",bada:e,version:r(/dolfin\/(\d+(\.\d+)?)/i)}:p?o={name:"Tizen",osname:"Tizen",tizen:e,version:r(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||g}:/qupzilla/i.test(t)?o={name:"QupZilla",qupzilla:e,version:r(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||g}:/chromium/i.test(t)?o={name:"Chromium",chromium:e,version:r(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||g}:/chrome|crios|crmo/i.test(t)?o={name:"Chrome",chrome:e,version:r(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:i?o={name:"Android",version:g}:/safari|applewebkit/i.test(t)?(o={name:"Safari",safari:e},g&&(o.version=g)):a?(o={name:"iphone"==a?"iPhone":"ipad"==a?"iPad":"iPod"},g&&(o.version=g)):o=/googlebot/i.test(t)?{name:"Googlebot",googlebot:e,version:r(/googlebot\/(\d+(\.\d+))/i)||g}:{name:r(/^(.*)\/(.*) /),version:n(/^(.*)\/(.*) /)},!o.msedge&&/(apple)?webkit/i.test(t)?(/(apple)?webkit\/537\.36/i.test(t)?(o.name=o.name||"Blink",o.blink=e):(o.name=o.name||"Webkit",o.webkit=e),!o.version&&g&&(o.version=g)):!o.opera&&/gecko\//i.test(t)&&(o.name=o.name||"Gecko",o.gecko=e,o.version=o.version||r(/gecko\/(\d+(\.\d+)?)/i)),o.windowsphone||!i&&!o.silk?!o.windowsphone&&a?(o[a]=e,o.ios=e,o.osname="iOS"):v?(o.mac=e,o.osname="macOS"):w?(o.xbox=e,o.osname="Xbox"):h?(o.windows=e,o.osname="Windows"):y&&(o.linux=e,o.osname="Linux"):(o.android=e,o.osname="Android");var k="";o.windows?k=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}(r(/Windows ((NT|XP)( \d\d?.\d)?)/i)):o.windowsphone?k=r(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):o.mac?k=(k=r(/Mac OS X (\d+([_\.\s]\d+)*)/i)).replace(/[_\s]/g,"."):a?k=(k=r(/os (\d+([_\s]\d+)*) like mac os x/i)).replace(/[_\s]/g,"."):i?k=r(/android[ \/-](\d+(\.\d+)*)/i):o.webos?k=r(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):o.blackberry?k=r(/rim\stablet\sos\s(\d+(\.\d+)*)/i):o.bada?k=r(/bada\/(\d+(\.\d+)*)/i):o.tizen&&(k=r(/tizen[\/\s](\d+(\.\d+)*)/i)),k&&(o.osversion=k);var S=!o.windows&&k.split(".")[0];return b||c||"ipad"==a||i&&(3==S||S>=4&&!P)||o.silk?o.tablet=e:(P||"iphone"==a||"ipod"==a||i||s||o.blackberry||o.webos||o.bada)&&(o.mobile=e),o.msedge||o.msie&&o.version>=10||o.yandexbrowser&&o.version>=15||o.vivaldi&&o.version>=1||o.chrome&&o.version>=20||o.samsungBrowser&&o.version>=4||o.firefox&&o.version>=20||o.safari&&o.version>=6||o.opera&&o.version>=10||o.ios&&o.osversion&&o.osversion.split(".")[0]>=6||o.blackberry&&o.version>=10.1||o.chromium&&o.version>=20?o.a=e:o.msie&&o.version<10||o.chrome&&o.version<20||o.firefox&&o.version<20||o.safari&&o.version<6||o.opera&&o.version<10||o.ios&&o.osversion&&o.osversion.split(".")[0]<6||o.chromium&&o.version<20?o.c=e:o.x=e,o}var r=t("undefined"!=typeof navigator&&navigator.userAgent||"");function n(e){return e.split(".").length}function o(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r++)n.push(t(e[r]));return n}function a(e){for(var t=Math.max(n(e[0]),n(e[1])),r=o(e,function(e){var r=t-n(e);return o((e+=new Array(r+1).join(".0")).split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});--t>=0;){if(r[0][t]>r[1][t])return 1;if(r[0][t]!==r[1][t])return-1;if(0===t)return 0}}function i(e,n,o){var i=r;"string"==typeof n&&(o=n,n=void 0),void 0===n&&(n=!1),o&&(i=t(o));var s=""+i.version;for(var c in e)if(e.hasOwnProperty(c)&&i[c]){if("string"!=typeof e[c])throw new Error("Browser version in the minVersion map should be a string: "+c+": "+String(e));return a([s,e[c]])<0}return n}return r.test=function(e){for(var t=0;t<e.length;++t){var n=e[t];if("string"==typeof n&&n in r)return!0}return!1},r.isUnsupportedBrowser=i,r.compareVersions=a,r.check=function(e,t,r){return!i(e,t,r)},r._detect=t,r.detect=t,r},void 0!==t&&t.exports?t.exports=o():n.bowser=o()},{}],29:[function(e,t,r){var n=Object.create||function(e){var t=function(){};return t.prototype=e,new t},o=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return r},a=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};function i(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=n(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0;var s,c=10;try{var u={};Object.defineProperty&&Object.defineProperty(u,"x",{value:0}),s=0===u.x}catch(e){s=!1}function d(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function l(e,t,r,o){var a,i,s;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((i=e._events)?(i.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),i=e._events),s=i[t]):(i=e._events=n(null),e._eventsCount=0),s){if("function"==typeof s?s=i[t]=o?[r,s]:[s,r]:o?s.unshift(r):s.push(r),!s.warned&&(a=d(e))&&a>0&&s.length>a){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",c.name,c.message)}}else s=i[t]=r,++e._eventsCount;return e}function p(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function f(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},o=a.call(p,n);return o.listener=r,n.wrapFn=o,o}function m(e,t,r){var n=e._events;if(!n)return[];var o=n[t];return o?"function"==typeof o?r?[o.listener||o]:[o]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(o):v(o,o.length):[]}function h(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function v(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}s?Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');c=e}}):i.defaultMaxListeners=c,i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return d(this)},i.prototype.emit=function(e){var t,r,n,o,a,i,s="error"===e;if(i=this._events)s=s&&null==i.error;else if(!s)return!1;if(s){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var c=new Error('Unhandled "error" event. ('+t+")");throw c.context=t,c}if(!(r=i[e]))return!1;var u="function"==typeof r;switch(n=arguments.length){case 1:!function(e,t,r){if(t)e.call(r);else for(var n=e.length,o=v(e,n),a=0;a<n;++a)o[a].call(r)}(r,u,this);break;case 2:!function(e,t,r,n){if(t)e.call(r,n);else for(var o=e.length,a=v(e,o),i=0;i<o;++i)a[i].call(r,n)}(r,u,this,arguments[1]);break;case 3:!function(e,t,r,n,o){if(t)e.call(r,n,o);else for(var a=e.length,i=v(e,a),s=0;s<a;++s)i[s].call(r,n,o)}(r,u,this,arguments[1],arguments[2]);break;case 4:!function(e,t,r,n,o,a){if(t)e.call(r,n,o,a);else for(var i=e.length,s=v(e,i),c=0;c<i;++c)s[c].call(r,n,o,a)}(r,u,this,arguments[1],arguments[2],arguments[3]);break;default:for(o=new Array(n-1),a=1;a<n;a++)o[a-1]=arguments[a];!function(e,t,r,n){if(t)e.apply(r,n);else for(var o=e.length,a=v(e,o),i=0;i<o;++i)a[i].apply(r,n)}(r,u,this,o)}return!0},i.prototype.addListener=function(e,t){return l(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return l(this,e,t,!0)},i.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,f(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,f(this,e,t)),this},i.prototype.removeListener=function(e,t){var r,o,a,i,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(o=this._events))return this;if(!(r=o[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=n(null):(delete o[e],o.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(a=-1,i=r.length-1;i>=0;i--)if(r[i]===t||r[i].listener===t){s=r[i].listener,a=i;break}if(a<0)return this;0===a?r.shift():function(e,t){for(var r=t,n=r+1,o=e.length;n<o;r+=1,n+=1)e[r]=e[n];e.pop()}(r,a),1===r.length&&(o[e]=r[0]),o.removeListener&&this.emit("removeListener",e,s||t)}return this},i.prototype.removeAllListeners=function(e){var t,r,a;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=n(null),this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=n(null):delete r[e]),this;if(0===arguments.length){var i,s=o(r);for(a=0;a<s.length;++a)"removeListener"!==(i=s[a])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=n(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)for(a=t.length-1;a>=0;a--)this.removeListener(e,t[a]);return this},i.prototype.listeners=function(e){return m(this,e,!0)},i.prototype.rawListeners=function(e){return m(this,e,!1)},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},i.prototype.listenerCount=h,i.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],30:[function(e,t,r){var n=1e3,o=60*n,a=60*o,i=24*a,s=7*i,c=365.25*i;function u(e,t,r,n){var o=t>=1.5*r;return Math.round(e/r)+" "+n+(o?"s":"")}t.exports=function(e,t){t=t||{};var r=typeof e;if("string"===r&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\-?\d?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*c;case"weeks":case"week":case"w":return r*s;case"days":case"day":case"d":return r*i;case"hours":case"hour":case"hrs":case"hr":case"h":return r*a;case"minutes":case"minute":case"mins":case"min":case"m":return r*o;case"seconds":case"second":case"secs":case"sec":case"s":return r*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}(e);if("number"===r&&!1===isNaN(e))return t.long?function(e){var t=Math.abs(e);if(t>=i)return u(e,t,i,"day");if(t>=a)return u(e,t,a,"hour");if(t>=o)return u(e,t,o,"minute");if(t>=n)return u(e,t,n,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=i)return Math.round(e/i)+"d";if(t>=a)return Math.round(e/a)+"h";if(t>=o)return Math.round(e/o)+"m";if(t>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],31:[function(e,t,r){(function(n){r.log=function(...e){return"object"==typeof console&&console.log&&console.log(...e)},r.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;e.splice(1,0,r,"color: inherit");let n=0,o=0;e[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(n++,"%c"===e&&(o=n))}),e.splice(o,0,r)},r.save=function(e){try{e?r.storage.setItem("debug",e):r.storage.removeItem("debug")}catch(e){}},r.load=function(){let e;try{e=r.storage.getItem("debug")}catch(e){}!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG);return e},r.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},r.storage=function(){try{return localStorage}catch(e){}}(),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.exports=e("./common")(r);const{formatters:o}=t.exports;o.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,e("_process"))},{"./common":32,_process:33}],32:[function(e,t,r){t.exports=function(t){function r(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return n.colors[Math.abs(t)%n.colors.length]}function n(e){let t;function i(...e){if(!i.enabled)return;const r=i,o=Number(new Date),a=o-(t||o);r.diff=a,r.prev=t,r.curr=o,t=o,e[0]=n.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(t,o)=>{if("%%"===t)return t;s++;const a=n.formatters[o];if("function"==typeof a){const n=e[s];t=a.call(r,n),e.splice(s,1),s--}return t}),n.formatArgs.call(r,e),(r.log||n.log).apply(r,e)}return i.namespace=e,i.enabled=n.enabled(e),i.useColors=n.useColors(),i.color=r(e),i.destroy=o,i.extend=a,"function"==typeof n.init&&n.init(i),n.instances.push(i),i}function o(){const e=n.instances.indexOf(this);return-1!==e&&(n.instances.splice(e,1),!0)}function a(e,t){return n(this.namespace+(void 0===t?":":t)+e)}return n.debug=n,n.default=n,n.coerce=function(e){return e instanceof Error?e.stack||e.message:e},n.disable=function(){n.enable("")},n.enable=function(e){let t;n.save(e),n.names=[],n.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),o=r.length;for(t=0;t<o;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")));for(t=0;t<n.instances.length;t++){const e=n.instances[t];e.enabled=n.enabled(e.namespace)}},n.enabled=function(e){if("*"===e[e.length-1])return!0;let t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=e("ms"),Object.keys(t).forEach(e=>{n[e]=t[e]}),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=r,n.enable(n.load()),n}},{ms:30}],33:[function(e,t,r){var n,o,a=t.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function c(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{o="function"==typeof clearTimeout?clearTimeout:s}catch(e){o=s}}();var u,d=[],l=!1,p=-1;function f(){l&&u&&(l=!1,u.length?d=u.concat(d):p=-1,d.length&&m())}function m(){if(!l){var e=c(f);l=!0;for(var t=d.length;t;){for(u=d,d=[];++p<t;)u&&u[p].run();p=-1,t=d.length}u=null,l=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===s||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function v(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];d.push(new h(e,t)),1!==d.length||l||c(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=v,a.addListener=v,a.once=v,a.off=v,a.removeListener=v,a.removeAllListeners=v,a.emit=v,a.prependListener=v,a.prependOnceListener=v,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},{}],34:[function(e,t,r){!function(e){function r(e){var t=(e=e||{}).min,r=e.max,n=e.integer||!1;if(null==t&&null==r?(t=0,r=1):null==t?t=r-1:null==r&&(r=t+1),r<t)throw new Error("invalid options, max must be >= min");return{min:t,max:r,integer:n}}function n(e){if((e=r(e)).max===e.min)return e.min;var t=Math.random()*(e.max-e.min+Number(!!e.integer))+e.min;return e.integer?Math.floor(t):t}t.exports=n,t.exports.generator=function(e){return e=r(e),function(t,r,o){return e.min=null!=t?t:e.min,e.max=null!=r?r:e.max,e.integer=null!=o?o:e.integer,n(e)}},t.exports.defaults=r}()},{}],35:[function(e,t,r){var n=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{push:"invalid",names:["value"]}]};Object.keys(n).forEach(function(e){n[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},{}],36:[function(e,t,r){var n=e("./parser"),o=e("./writer");r.write=o,r.parse=n.parse,r.parseFmtpConfig=n.parseFmtpConfig,r.parseParams=n.parseParams,r.parsePayloads=n.parsePayloads,r.parseRemoteCandidates=n.parseRemoteCandidates,r.parseImageAttributes=n.parseImageAttributes,r.parseSimulcastStreamList=n.parseSimulcastStreamList},{"./parser":37,"./writer":38}],37:[function(e,t,r){var n=function(e){return String(Number(e))===e?Number(e):e},o=function(e,t,r){var o=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:o&&!t[e.name]&&(t[e.name]={});var a=e.push?{}:o?t[e.name]:t;!function(e,t,r,o){if(o&&!r)t[o]=n(e[1]);else for(var a=0;a<r.length;a+=1)null!=e[a+1]&&(t[r[a]]=n(e[a+1]))}(r.match(e.reg),a,e.names,e.name),e.push&&t[e.push].push(a)},a=e("./grammar"),i=RegExp.prototype.test.bind(/^([a-z])=(.*)/);r.parse=function(e){var t={},r=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(i).forEach(function(e){var t=e[0],i=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),n=r[r.length-1]);for(var s=0;s<(a[t]||[]).length;s+=1){var c=a[t][s];if(c.reg.test(i))return o(c,n,i)}}),t.media=r,t};var s=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=n(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};r.parseParams=function(e){return e.split(/\;\s?/).reduce(s,{})},r.parseFmtpConfig=r.parseParams,r.parsePayloads=function(e){return e.split(" ").map(Number)},r.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(n),o=0;o<r.length;o+=3)t.push({component:r[o],ip:r[o+1],port:r[o+2]});return t},r.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(s,{})})},r.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,r=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),r=!0),{scid:t,paused:r}})})}},{"./grammar":35}],38:[function(e,t,r){var n=e("./grammar"),o=/%[sdv%]/g,a=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var a=0;a<t.names.length;a+=1){var i=t.names[a];t.name?n.push(r[t.name][i]):n.push(r[t.names[a]])}else n.push(r[t.name]);return function(e){var t=1,r=arguments,n=r.length;return e.replace(o,function(e){if(t>=n)return e;var o=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(o);case"%d":return Number(o);case"%v":return""}})}.apply(null,n)},i=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];t.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var r=t.outerOrder||i,o=t.innerOrder||s,c=[];return r.forEach(function(t){n[t].forEach(function(r){r.name in e&&null!=e[r.name]?c.push(a(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){c.push(a(t,r,e))})})}),e.media.forEach(function(e){c.push(a("m",n.m[0],e)),o.forEach(function(t){n[t].forEach(function(r){r.name in e&&null!=e[r.name]?c.push(a(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){c.push(a(t,r,e))})})})}),c.join("\r\n")+"\r\n"}},{"./grammar":35}]},{},[25])(25)});